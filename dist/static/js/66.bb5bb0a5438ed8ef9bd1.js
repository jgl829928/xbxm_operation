webpackJsonp([66],{HDLz:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("Dd8w"),s=a.n(r),n=(a("eMGh"),a("2A+d")),o=a("TIfe"),i={name:"editRecord",data:function(){var e=this;return{pickerOptions:{disabledDate:function(e){var t=new Date;return e.getTime()>new Date(t.getFullYear(),t.getMonth(),0,0,0,0).getTime()}},reqData:{accountFor:"",amount:"",assess:"",companyId:"",contractValue:"0.00",financeId:"",marketCode:"",payment:"",paymentMethod:"",remittee:""},amountPaid:"",rules:{marketCode:[{required:!0,message:"请选择商场",trigger:"change"}],companyId:[{required:!0,message:"请选择物业公司",trigger:"change"}],assess:[{required:!0,message:"请选择考核周期",trigger:"change"}],amount:[{validator:function(t,a,r){1==/^\d+(\.\d{1,2})?$/.test(a)&&Number(a)>e.reqData.contractValue?r(new Error("扣款金额不能超过合同金额")):r()},required:!1,trigger:"blur"},{pattern:/^\d+(\.\d{1,2})?$/,message:"请输入正确格式的金额(2位小数)",trigger:"blur"}],payment:[{max:50,message:"输入字数在50字以内",trigger:"blur"}],remittee:[{max:50,message:"输入字数在50字以内",trigger:"blur"}],accountFor:[{max:50,message:"输入字数在50字以内",trigger:"blur"}],paymentMethod:[{max:50,message:"输入字数在50字以内",trigger:"blur"}]},companyList:[],fileList:[],uploadUrl:n.a.imageUpload,marketSearch:[],checkEdit:!0,recode:{},role:!1}},components:{selectMarket:a("FTcF").a},created:function(){this.getEditData(this.$route.params.financeId)},computed:{gTicket:function(){return this.$store.state.gTicket},reMsg:{get:function(){return this.reqData.contractValue-this.reqData.amount}}},methods:{submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;var a=[];0!=t.fileList.length&&t.fileList.forEach(function(e){var t={};t.name=e.name,t.url=e.url,-1==a.indexOf(e)&&a.push(t)});var r=s()({},t.reqData,{imgUrl:a,amountPaid:t.reMsg,totalDays:t.recode.totalDays||"",qualifiedDays:t.recode.qualifiedDays||""});t.handleSave("put",r)})},handleSave:function(e,t){var a=this;this.$http({url:n.a.finance,method:e,data:t}).then(function(e){e&&(a.$message.success(e.msg),a.$router.push({name:"expenditure"}),a.$store.commit("delete_tabs",a.$route))})},getEditData:function(e){var t=this;this.$http.get(n.a.finance,{params:{financeId:e}}).then(function(e){e&&0!=e.data.length&&(t.getCompanyList(e.data[0].marketCode),setTimeout(function(){t.reqData=Object(o.d)(e.data[0],!0,["marketName","companyName","createUser","createName","createTime","year","month","totalDays"]),t.companyChange(),e.data[0].imgUrl&&(t.fileList=e.data[0].imgUrl)},20))})},handleRemove:function(e,t){this.fileList=t},handleList:function(e,t,a){e&&0==e.code&&e.data&&this.fileList.push(e.data)},handleExceed:function(e,t){this.$message.warning("当前限制选择 3 个文件，本次选择了 "+e.length+" 个文件，共选择了 "+(e.length+t.length)+" 个文件")},beforeRemove:function(e,t){return this.$confirm("确定移除 "+e.name+"？")},beforeLogoUpload:function(e){var t="image/jpeg"===e.type||"image/png",a=e.size/1024/1024<5;return t||this.$message.error("上传图片只能是 jpg、png、jpeg、bmp格式!"),a||this.$message.error("上传图片大小不能超过5MB!"),t&&a},companyChange:function(){this.getPay(),this.getRecord()},getPay:function(){var e=this;this.$http.get(n.a.financeContract,{params:{companyId:this.reqData.companyId}}).then(function(t){t&&0==t.code&&t.data&&(e.reqData.contractValue=t.data.contractValue)})},getRecord:function(){var e=this;""!=this.reqData.companyId&&""!=this.reqData.assess&&this.$http.get(n.a.financeCheck,{params:{companyId:this.reqData.companyId,data:this.reqData.assess}}).then(function(t){t&&0==t.code&&t.data?e.recode=t.data:e.recode={}})},getCompanyList:function(e){var t=this;this.$http({url:n.a.companyList,params:{marketCode:e},method:"get",showLoading:!1}).then(function(e){e&&0==e.code&&e.data&&(t.companyList=e.data)})}}},l={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"g-add-record-two"},[a("el-form",{ref:"reqData",staticClass:"c-search-form",attrs:{model:e.reqData,rules:e.rules,"label-width":"110px","label-position":"right",inline:!0}},[a("el-row",{staticClass:"u-bottom",attrs:{gutter:32}},[a("el-col",{attrs:{span:8,xs:24}},[a("el-form-item",{attrs:{label:"所属商场",prop:"marketCode"}},[a("select-market",{attrs:{reqData:e.reqData,checkMarket:e.checkEdit}})],1)],1),e._v(" "),a("el-col",{attrs:{span:8,xs:24}},[a("el-form-item",{attrs:{label:"物业公司",prop:"companyId"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择"},on:{change:e.companyChange},model:{value:e.reqData.companyId,callback:function(t){e.$set(e.reqData,"companyId",t)},expression:"reqData.companyId"}},e._l(e.companyList,function(e,t){return a("el-option",{key:t,attrs:{label:e.companyName,value:e.companyId}})}))],1)],1),e._v(" "),a("el-col",{attrs:{span:8,xs:24}},[a("el-form-item",{attrs:{label:"物业考核周期",prop:"assess"}},[a("el-date-picker",{attrs:{type:"month","value-format":"yyyy-MM",placeholder:"选择月","picker-options":e.pickerOptions,disabled:""},on:{change:e.getRecord},model:{value:e.reqData.assess,callback:function(t){e.$set(e.reqData,"assess",t)},expression:"reqData.assess"}})],1)],1)],1),e._v(" "),a("el-row",{staticClass:"u-top",attrs:{gutter:32}},[a("el-col",{attrs:{span:8,xs:24}},[a("el-form-item",{attrs:{label:"收款方",prop:"remittee"}},[a("el-input",{attrs:{clearable:""},model:{value:e.reqData.remittee,callback:function(t){e.$set(e.reqData,"remittee","string"==typeof t?t.trim():t)},expression:"reqData.remittee"}})],1)],1),e._v(" "),a("el-col",{staticClass:"u-tip",attrs:{span:11,xs:24}},[a("el-form-item",{attrs:{label:"合同金额（应付)",prop:"contractValue","label-width":"140px"}},[e._v("\n            "+e._s(e.reqData.contractValue||0)+"\n          ")]),e._v(" "),a("span",[e._v("收费标准*人事编制")])],1)],1),e._v(" "),a("el-row",{attrs:{gutter:32}},[a("el-col",{attrs:{span:8,xs:24}},[a("el-form-item",{attrs:{label:"扣款金额",prop:"amount"}},[a("el-input",{attrs:{clearable:"",placeholder:"0.00"},model:{value:e.reqData.amount,callback:function(t){e.$set(e.reqData,"amount","string"==typeof t?t.trim():t)},expression:"reqData.amount"}})],1)],1),e._v(" "),a("el-col",{staticClass:"u-tip-down",attrs:{span:12,xs:24}},[a("el-form-item",{attrs:{label:"实付金额",prop:"amountPaid","label-width":"102px"}},[e._v("\n            "+e._s(e.reMsg||0)+"\n          ")])],1)],1),e._v(" "),a("el-row",{attrs:{gutter:32}},[a("el-col",{attrs:{span:8,xs:24}},[a("el-form-item",{attrs:{label:"说明",prop:"accountFor"}},[a("el-input",{attrs:{clearable:""},model:{value:e.reqData.accountFor,callback:function(t){e.$set(e.reqData,"accountFor","string"==typeof t?t.trim():t)},expression:"reqData.accountFor"}})],1)],1),e._v(" "),a("el-col",{staticClass:"u-tip-down",attrs:{span:11,xs:24}},[a("el-form-item",{attrs:{label:"付款方",prop:"payment","label-width":"102px"}},[a("el-input",{attrs:{clearable:""},model:{value:e.reqData.payment,callback:function(t){e.$set(e.reqData,"payment","string"==typeof t?t.trim():t)},expression:"reqData.payment"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:32}},[a("el-col",{attrs:{span:8,xs:24}},[a("el-form-item",{attrs:{label:"付款方式",prop:"paymentMethod"}},[a("el-input",{attrs:{clearable:""},model:{value:e.reqData.paymentMethod,callback:function(t){e.$set(e.reqData,"paymentMethod","string"==typeof t?t.trim():t)},expression:"reqData.paymentMethod"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:32}},[a("el-col",{attrs:{span:11,xs:24}},[a("el-form-item",{attrs:{label:"凭证\n",prop:"skuCode"}},[a("el-upload",{staticClass:"upload-demo",attrs:{action:e.$http.defaults.baseURL+e.uploadUrl,"before-remove":e.beforeRemove,multiple:"",limit:10,headers:{gTicket:e.gTicket},"on-exceed":e.handleExceed,"file-list":e.fileList,"on-success":e.handleList,"before-upload":e.beforeLogoUpload,"on-remove":e.handleRemove}},[a("el-button",{staticClass:"btn-80 btn-upload",attrs:{size:"small",type:"primary"}},[e._v("浏览")])],1)],1)],1)],1),e._v(" "),a("el-row",{staticClass:"u-button",attrs:{gutter:32}},[a("el-col",{attrs:{span:8,offset:16}},[a("el-button",{staticClass:"btn-save-big",attrs:{type:"primary"},on:{click:function(t){e.submitForm("reqData")}}},[e._v("保存")])],1)],1)],1)],1)},staticRenderFns:[]};var c=a("VU/8")(i,l,!1,function(e){a("O57+"),a("hJbf")},"data-v-199c2299",null);t.default=c.exports},"O57+":function(e,t){},hJbf:function(e,t){}});
//# sourceMappingURL=66.bb5bb0a5438ed8ef9bd1.js.map