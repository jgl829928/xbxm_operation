webpackJsonp([67],{"7RBr":function(e,t){},Vo8F:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("4YfN"),l=a.n(r),i=a("2A+d"),s=a("eMGh"),o=a("TIfe"),n={name:"auditProcess",data:function(){return{dialogFormVisibleL:!1,dialogVisibleM:!1,reqData:{auditTypeCode:"",auditType:"",marketCode:"",areaCode:"",roleNames:[{roleName:""}]},itemList:[],form:{name:""},auditInfo:[],auditTypeList:[{label:"指标任务审核流程",value:1},{label:"合同常规审核流程",value:2},{label:"合同终止审核流程",value:3},{label:"合同非常规审核流程",value:4},{label:"合同费用退款审核流程",value:5},{label:"日常费用退款审核流程",value:6}],rules:{marketCode:[{required:!0,message:"请选择商场",trigger:"change"}],areaCode:[{required:!0,message:"请选择所在省市",trigger:"change"}],auditType:[{required:!0,message:"请选择商场名称",trigger:"change"}]},reqBdata:{auditTypeCode:"",auditType:"",marketCode:"",areaCode:"",roleNames:[{roleName:""}]},formLabelWidth:"120px",areaList:[],marketList:[],auditorList:[],checkPost:""}},created:function(){this.getData(),this.getRoles(),this.handleCascader(null,"areaList",s.b.cascaderMarket)},methods:{rightControl:function(e){return this.$store.getters.getPermission(e)},getRoles:function(){var e=this;this.$http.get(i.a.auditsRoles).then(function(t){t&&0==t.code&&t.data&&(e.auditorList=t.data)})},reset:function(){var e=this;this.dialogFormVisibleL=!1,this.marketList=[],this.$refs.reqData.resetFields(),setTimeout(function(){e.$refs.reqData.clearValidate()},20)},addcontract_type:function(e){var t=this;this.dialogFormVisibleL=!0,1!=e?(this.checkPost=!1,this.handleCascader(e.areaCode,"marketList",s.b.marketSearch),this.$nextTick(function(){window.localStorage.setItem("roleNamesLen",e.roleNames.length),t.reqData=Object(o.d)(e,!0,["createTime","createUser","createUserName","updateTime","updateUser","updateUserName"]),t.reqData.roleNames=t.reqData.roleNames.map(function(e){return{roleName:e}})})):(this.checkPost=!0,this.reqData=Object(o.d)(this.reqBdata,!0,""))},handleSave:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;Object(o.d)(t.reqData,!0,"roleNames");var a=t.reqData.roleNames.map(function(e){return e.roleName});if(t.checkPost){var r=l()({},t.reqData,{roleNames:a});t.handleData("post","",r)}else{var i=a;t.handleData("put",t.reqData.auditTypeCode,i)}})},handleData:function(e,t,a){var r=this;this.$http({url:i.a.audits+"/"+t,method:e,data:a}).then(function(e){e&&(0==e.code?(r.$message.success(e.msg),r.dialogFormVisibleL=!1,r.getData()):r.$message.error(e.msg))})},removeDomain:function(e){var t=this.reqData.roleNames.indexOf(e);-1!==t&&this.reqData.roleNames.splice(t,1)},addDomain:function(){this.reqData.roleNames.push({roleName:""}),this.reqData.roleNames.length>10&&(this.reqData.roleNames.length=10,this.$message.error("最多只能添加10个审核"))},checkInfo:function(e){this.dialogVisibleM=!0,this.auditInfo=e},getData:function(){Object(o.b)(void 0,void 0,i.a.audits,this)},handleCascader:function(e,t,a){var r=this;this.$http({url:a,method:"get",params:{areaCode:e}}).then(function(e){e&&0==e.code&&(r[t]=e.data)})},changeMarket:function(e){this.reqData.marketCode="",e?this.handleCascader(e,"marketList",s.b.marketSearch):this.marketList=[]}}},c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"g-audit-process"},[a("el-row",[a("el-col",{directives:[{name:"show",rawName:"v-show",value:e.rightControl("auditProcess_add"),expression:"rightControl('auditProcess_add')"}],attrs:{span:8}},[a("el-button",{staticClass:"btn-search btn-add",attrs:{type:"primary"},on:{click:function(t){e.addcontract_type(1)}}},[e._v("添加")])],1)],1),e._v(" "),a("el-dialog",{staticClass:"l-dialog",attrs:{title:"审核流程",visible:e.dialogFormVisibleL},on:{"update:visible":function(t){e.dialogFormVisibleL=t},close:e.reset}},[a("el-form",{ref:"reqData",staticClass:"c-search-form",attrs:{model:e.reqData,rules:e.rules,"label-width":"102px",inline:!0,"label-position":"right"}},[a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"流程类型",prop:"auditType"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择",disabled:!e.checkPost},model:{value:e.reqData.auditType,callback:function(t){e.$set(e.reqData,"auditType",t)},expression:"reqData.auditType"}},e._l(e.auditTypeList,function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})}))],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"所在省市",prop:"areaCode"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择",disabled:!e.checkPost},on:{change:function(t){e.changeMarket(e.reqData.areaCode)}},model:{value:e.reqData.areaCode,callback:function(t){e.$set(e.reqData,"areaCode",t)},expression:"reqData.areaCode"}},e._l(e.areaList,function(e,t){return a("el-option",{key:t,attrs:{label:e.areaName,value:e.areaCode}})}))],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"商场名称",prop:"marketCode"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择",disabled:!e.checkPost},model:{value:e.reqData.marketCode,callback:function(t){e.$set(e.reqData,"marketCode",t)},expression:"reqData.marketCode"}},e._l(e.marketList,function(e,t){return a("el-option",{key:t,attrs:{label:e.marketName,value:e.marketCode}})}))],1)],1)],1),e._v(" "),a("el-row",{staticClass:"u-area-input"},[a("el-col",{staticClass:"u-center",attrs:{span:3}},[a("span",[e._v("流程审核")])]),e._v(" "),a("el-col",{staticClass:"u-domain",attrs:{span:19}},e._l(e.reqData.roleNames,function(t,r){return a("el-form-item",{key:r,attrs:{label:"审核人"+(r+1),prop:"roleNames."+r+".roleName",rules:{required:!0,message:"审核人不能为空",trigger:"change"},"label-width":"70px"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:t.roleName,callback:function(a){e.$set(t,"roleName",a)},expression:"domain.roleName"}},e._l(e.auditorList,function(e,t){return a("el-option",{key:t,attrs:{label:e.roleName,value:e.roleName}})})),e._v(" "),0!=r?a("i",{staticClass:"el-icon-remove-outline u-del",on:{click:function(a){a.preventDefault(),e.removeDomain(t)}}}):e._e(),e._v(" "),0==r?a("i",{staticClass:"el-icon-circle-plus-outline u-add",on:{click:e.addDomain}}):e._e()],1)}))],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"btn-save",attrs:{type:"primary"},on:{click:function(t){e.handleSave("reqData")}}},[e._v("保存")]),e._v(" "),a("el-button",{staticClass:"btn-reset",attrs:{type:"primary"},on:{click:e.reset}},[e._v("取消")])],1)],1),e._v(" "),a("div",{staticClass:"c-table-wrap"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.itemList,align:"center",height:"500",stripe:""}},[a("el-table-column",{attrs:{align:"center",type:"index",label:"序号",width:"50"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"auditTypeCode",label:"流程编号"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"auditType",label:"流程类型"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(e.auditTypeList,function(r,l){return a("div",{key:l},[e._v("\n              "+e._s(t.row.auditType==r.value?r.label:"")+"\n            ")])})}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"marketName",label:"商场名称"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"areaName",label:"所在省市"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"createTime","min-width":"165px",label:"添加时间"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"createUserName",label:"添加人"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"updateTime","min-width":"165px",label:"修改时间"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"updateUserName",label:"修改人"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"操作",fixed:"right","min-width":"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticClass:"btn-handle",attrs:{type:"primary",disabled:!e.rightControl("auditProcess_edit")},on:{click:function(a){e.addcontract_type(t.row)}}},[e._v("\n                修改\n            ")]),e._v(" "),a("el-button",{staticClass:"btn-handle",attrs:{type:"primary",disabled:!e.rightControl("auditProcess_info")},on:{click:function(a){e.checkInfo(t.row.roleNames)}}},[e._v("\n                详情\n            ")])]}}])})],1),e._v(" "),a("el-dialog",{staticClass:"m-dialog el-steps-dialog",attrs:{title:"提示",visible:e.dialogVisibleM,width:"30%"},on:{"update:visible":function(t){e.dialogVisibleM=t}}},[a("el-steps",{attrs:{space:200,"align-center":""}},e._l(e.auditInfo,function(e,t){return a("el-step",{key:t,attrs:{title:e}})})),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"btn-save",attrs:{type:"primary"},on:{click:function(t){e.dialogVisibleM=!1}}},[e._v("关闭")])],1)],1)],1)],1)},staticRenderFns:[]};var d=a("vSla")(n,c,!1,function(e){a("tbKi"),a("7RBr")},"data-v-180317ac",null);t.default=d.exports},tbKi:function(e,t){}});
//# sourceMappingURL=67.c9522b97932a927ad9da.js.map