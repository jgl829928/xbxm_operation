webpackJsonp([34],{oHLn:function(e,t){},pAic:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("g4PW"),i=a.n(s),r=a("c/Tr"),l=a.n(r),o=a("lHA8"),n=a.n(o),d=a("woOf"),c=a.n(d),p=a("mfbU"),u={data:function(){return{reqData:{currentPage:1,pageSize:20,affiliation:"",available:"",name:""},itemList:[],pageparams:{},dialog_title:"",add_data:{affiliation:1,available:1,name:""},add_rules:{name:[{required:!0,message:"请输入角色名称",trigger:"blur"},{max:32,message:"角色名称不能多于32个字符",trigger:"blur"}]},edit_id:"",dialogFormVisible:!1,access_dialogVisible:!1,distribute_name:"",distribute_affiliation:"",distribute_id:"",distribute_app_merchant:[],distribute_app_operate:[],distribute_operate:[],distribute_operate_check:[],app_operate_check:[],app_merchant_check:[],tree_checked:[],accessInfo_dialog:!1,accessInfo_id:"",accessInfo:{},menuTree:{},form:{name:"",state:!0},rules:{name:[{required:!0,message:"请输入活动名称",trigger:"blur"}]},formLabelWidth:"100px",defaultProps:{children:"list",label:"name"}}},components:{pagenation:a("hm3b").a},name:"roleMain",methods:{getOtherData:function(e){var t=this,a=p.a.menus+"/"+e;this.$http.get(a).then(function(a){if(a&&0===a.code&&a.data)switch(e){case 1:t.distribute_operate=a.data;break;case 2:t.distribute_app_operate=a.data;break;case 3:t.distribute_app_merchant=a.data}})},getListData:function(){var e=this;this.$http.get(p.a.roleList,{params:this.reqData}).then(function(t){t&&0===t.code&&t.data?(e.itemList=t.data,e.pageparams=t.page):e.itemList=[]})},search:function(){this.reqData.currentPage=1,this.getListData()},indexMethod:function(e){return e+20*(this.reqData.currentPage-1)+1},handlePage:function(e){this.reqData.currentPage=e,this.getListData()},add:function(){var e=this;this.dialogFormVisible=!0,this.dialog_title="角色-添加",setTimeout(function(){e.$refs.add_form.resetFields()},50)},clean_data:function(){c()(this.add_data,this.$options.data().add_data)},edit:function(e,t){this.dialogFormVisible=!0,this.dialog_title="角色-修改",this.edit_id=t.roleId,this.add_data={affiliation:t.affiliation.code,available:t.available.code,name:t.name}},save_data:function(){var e=this;this.$refs.add_form.validate(function(t){if(t)if("角色-添加"===e.dialog_title)e.$http.post(p.a.operate_role,e.add_data).then(function(t){t&&0===t.code&&(e.$message({message:"保存成功",type:"success"}),e.dialogFormVisible=!1,e.getListData())});else{var a=c()({},e.add_data);a.roleId=e.edit_id,e.$http.put(p.a.operate_role,a).then(function(t){t&&0===t.code&&(e.$message({message:"保存成功",type:"success"}),e.dialogFormVisible=!1,e.getListData())})}})},distribute_access:function(e,t){var a=this;this.access_dialogVisible=!0,this.distribute_id=t.roleId,this.distribute_name=t.name,this.distribute_affiliation=t.affiliation.desc;var s=p.a.operate_role+"/"+t.roleId;this.$http.get(s).then(function(e){e&&0===e.code&&e.data&&(a.tree_checked=[],e.data.menuTree&&e.data.menuTree.operate&&0!==e.data.menuTree.operate.length&&a.$refs.operate_tree.setCheckedKeys(a.filterIds(e.data.menuTree.operate)),e.data.menuTree&&e.data.menuTree.app_operate&&0!==e.data.menuTree.app_operate.length&&a.$refs.appOperate_tree.setCheckedKeys(a.filterIds(e.data.menuTree.app_operate)),e.data.menuTree&&e.data.menuTree.app_merchant&&0!==e.data.menuTree.app_merchant.length&&a.$refs.appMerchant_tree.setCheckedKeys(a.filterIds(e.data.menuTree.app_merchant)))})},filterIds:function(e){var t=this;if(e&&0!==e.length)return e.forEach(function(e,a){4==e.menuType.code?t.tree_checked.push(e.menuId):t.filterIds(e.list)}),this.tree_checked},distribute_save:function(){var e=this,t=this.$refs.operate_tree.getCheckedNodes(!0,!0),a=this.$refs.appOperate_tree.getCheckedNodes(!0,!0),s=this.$refs.appMerchant_tree.getCheckedNodes(!0,!0),i=new n.a;this.processData(t,i),this.processData(a,i),this.processData(s,i);var r={menuIds:l()(i),roleId:this.distribute_id};this.$http.post(p.a.distribute_access,r).then(function(t){t&&0===t.code&&e.$message.success("保存成功"),e.access_dialogVisible=!1,e.getListData()})},processData:function(e,t){var a=this;e.forEach(function(e){var s=a.addSearchData(e.menuId);s&&t.add(s),t.add(e.menuId)})},addSearchData:function(e){var t=this.$refs.operate_tree.getNode(e);if(!i()(t,null)&&0===t.childNodes.length){var a=t.parent.childNodes||t.childNodes;if(a.length>1){var s=a.filter(function(e){return/([\u67e5][\u8be2]*)/g.test(e.label)});if(s&&s.length>=1)return s[0].key}}},access_info:function(e,t){var a=this;this.accessInfo_dialog=!0,this.accessInfo_id=t.roleId;var s=p.a.operate_role+"/"+t.roleId;this.$http.get(s).then(function(e){e&&0===e.code&&e.data&&(a.accessInfo=e.data,a.accessInfo.affiliation=a.accessInfo.affiliation.desc,a.menuTree=e.data.menuTree||[])})}},created:function(){this.getListData(),this.getOtherData(1),this.getOtherData(2),this.getOtherData(3)}},_={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"contract-receipts"},[a("el-form",{ref:"reqData",staticClass:"c-search-form",attrs:{model:e.reqData,"label-width":"102px",inline:!0,"label-position":"right"}},[a("el-row",[a("el-col",{attrs:{span:8,xs:24}},[a("el-form-item",{attrs:{label:"角色名称",prop:"name","min-width":"110"}},[a("el-input",{attrs:{clearable:""},model:{value:e.reqData.name,callback:function(t){e.$set(e.reqData,"name","string"==typeof t?t.trim():t)},expression:"reqData.name"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:8,xs:24}},[a("el-form-item",{attrs:{label:"所属组织架构",prop:"affiliation"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:e.reqData.affiliation,callback:function(t){e.$set(e.reqData,"affiliation",t)},expression:"reqData.affiliation"}},[a("el-option",{attrs:{label:"总部",value:1}}),e._v(" "),a("el-option",{attrs:{label:"商场",value:2}})],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:8,xs:24}},[a("el-form-item",{attrs:{label:"状态",prop:"available"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:e.reqData.available,callback:function(t){e.$set(e.reqData,"available",t)},expression:"reqData.available"}},[a("el-option",{attrs:{label:"启用",value:"1"}}),e._v(" "),a("el-option",{attrs:{label:"停用",value:"0"}})],1)],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:8,offset:16}},[a("div",{staticClass:"c-footer-btn"},[a("el-button",{staticClass:"btn-search",attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.search}},[e._v("查询")])],1)])],1)],1),e._v(" "),a("div",[a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.$store.getters.getPermission("roleMain_2"),expression:"$store.getters.getPermission('roleMain_2')"}],staticClass:"btn-search btn-add",attrs:{type:"primary"},on:{click:e.add}},[e._v("添加")])],1),e._v(" "),a("div",{staticClass:"c-table-wrap"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.itemList,align:"center",stripe:"",height:"500"}},[a("el-table-column",{attrs:{align:"center",type:"index",label:"序号",width:"50",index:e.indexMethod}}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"name",label:"角色名称"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"affiliation",label:"所属组织架构","min-width":"85"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("p",[e._v(e._s(t.row.affiliation.desc))])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"available",label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("p",[e._v(e._s(t.row.available.desc))])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"createTime",label:"登记时间","min-width":"165"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"creater",label:"登记人"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"操作","min-width":"230"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticClass:"btn-handle",attrs:{type:"primary",disabled:!e.$store.getters.getPermission("roleMain_3")},on:{click:function(a){e.edit(t.$index,t.row)}}},[e._v("\n            修改\n          ")]),e._v(" "),a("el-button",{staticClass:"btn-handle",attrs:{type:"primary",disabled:!e.$store.getters.getPermission("roleMain_5")},on:{click:function(a){e.distribute_access(t.$index,t.row)}}},[e._v("\n            分配权限\n          ")]),e._v(" "),a("el-button",{staticClass:"btn-handle",attrs:{type:"primary",disabled:!e.$store.getters.getPermission("roleMain_4")},on:{click:function(a){e.access_info(t.$index,t.row)}}},[e._v("\n            权限详情\n          ")])]}}])})],1)],1),e._v(" "),a("div",{staticClass:"pagination-box"},[a("pagenation",{attrs:{pageparams:e.pageparams,itemList:e.itemList},on:{handlePage:e.handlePage}})],1),e._v(" "),a("el-dialog",{staticClass:"s-dialog",attrs:{title:e.dialog_title,visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t},close:e.clean_data}},[a("el-form",{ref:"add_form",attrs:{model:e.add_data,rules:e.add_rules}},[a("el-form-item",{attrs:{label:"所属组织架构","label-width":e.formLabelWidth,prop:"affiliation"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:e.add_data.affiliation,callback:function(t){e.$set(e.add_data,"affiliation",t)},expression:"add_data.affiliation"}},[a("el-option",{attrs:{label:"总部",value:1}}),e._v(" "),a("el-option",{attrs:{label:"商场",value:2}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"角色名称","label-width":e.formLabelWidth,prop:"name"}},[a("el-input",{attrs:{"auto-complete":"off",clearable:""},model:{value:e.add_data.name,callback:function(t){e.$set(e.add_data,"name","string"==typeof t?t.trim():t)},expression:"add_data.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"状态","label-width":e.formLabelWidth,prop:"available"}},[a("el-radio-group",{model:{value:e.add_data.available,callback:function(t){e.$set(e.add_data,"available",t)},expression:"add_data.available"}},[a("el-radio",{attrs:{label:1,value:"1"}},[e._v("启用")]),e._v(" "),a("el-radio",{attrs:{label:0,value:"0"}},[e._v("停用")])],1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"btn-save",attrs:{type:"primary"},on:{click:e.save_data}},[e._v("保 存")]),e._v(" "),a("el-button",{staticClass:"btn-reset",on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")])],1)],1),e._v(" "),a("el-dialog",{staticClass:"m-dialog access-dialog",attrs:{title:"权限-分配",visible:e.access_dialogVisible},on:{"update:visible":function(t){e.access_dialogVisible=t}}},[a("el-row",{attrs:{gutter:32}},[a("el-col",{attrs:{span:16}},[a("div",{staticClass:"u-roleInfo-item"},[a("label",[e._v("角色名称")]),e._v(" "),a("span",[e._v(e._s(e.distribute_name))])])]),e._v(" "),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"u-roleInfo-item"},[a("label",[e._v("所属组织架构")]),e._v(" "),a("span",[e._v(e._s(e.distribute_affiliation))])])])],1),e._v(" "),a("el-row",{attrs:{gutter:32}},[a("el-col",{attrs:{span:24}},[a("div",{staticClass:"u-menu-title"},[e._v("运营后台功能菜单")]),e._v(" "),a("el-scrollbar",{staticStyle:{height:"400px"}},[a("el-tree",{ref:"operate_tree",attrs:{data:e.distribute_operate,"default-checked-keys":e.distribute_operate_check,"show-checkbox":"","node-key":"menuId",props:e.defaultProps}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:32}},[a("el-col",{attrs:{span:24}},[a("div",{staticClass:"u-menu-title"},[e._v("APP运营功能菜单")]),e._v(" "),a("el-tree",{ref:"appOperate_tree",attrs:{data:e.distribute_app_operate,"default-checked-keys":e.app_operate_check,"show-checkbox":"","node-key":"menuId",props:e.defaultProps}})],1)],1),e._v(" "),a("el-row",{attrs:{gutter:32}},[a("el-col",{attrs:{span:24}},[a("div",{staticClass:"u-menu-title"},[e._v("APP商户功能菜单")]),e._v(" "),a("el-tree",{ref:"appMerchant_tree",attrs:{data:e.distribute_app_merchant,"default-checked-keys":e.app_merchant_check,"show-checkbox":"","node-key":"menuId",props:e.defaultProps}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"btn-save",attrs:{type:"primary"},on:{click:e.distribute_save}},[e._v("保存")]),e._v(" "),a("el-button",{staticClass:"btn-reset",attrs:{type:"primary"},on:{click:function(t){e.access_dialogVisible=!1}}},[e._v("取消")])],1)],1),e._v(" "),a("el-dialog",{staticClass:"m-dialog access-dialog",attrs:{title:"权限-详情",visible:e.accessInfo_dialog},on:{"update:visible":function(t){e.accessInfo_dialog=t}}},[a("el-row",{attrs:{gutter:32}},[a("el-col",{attrs:{span:16}},[a("div",{staticClass:"u-roleInfo-item"},[a("label",[e._v("角色名称")]),e._v(" "),a("span",[e._v(e._s(e.accessInfo.name))])])]),e._v(" "),a("el-col",{attrs:{span:8}},[a("div",{staticClass:"u-roleInfo-item"},[a("label",[e._v("所属组织架构")]),e._v(" "),a("span",[e._v(e._s(e.accessInfo.affiliation))])])])],1),e._v(" "),a("el-row",{attrs:{gutter:32}},[a("el-col",{attrs:{span:24}},[a("div",{staticClass:"u-menu-title"},[e._v("运营后台功能菜单")]),e._v(" "),a("el-scrollbar",{staticStyle:{height:"400px"}},[a("el-tree",{attrs:{data:e.menuTree.operate,"node-key":"menuId",props:e.defaultProps}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:32}},[a("el-col",{attrs:{span:24}},[a("div",{staticClass:"u-menu-title"},[e._v("APP运营功能菜单")]),e._v(" "),a("el-tree",{attrs:{data:e.menuTree.app_operate,"node-key":"menuId",props:e.defaultProps}})],1)],1),e._v(" "),a("el-row",{attrs:{gutter:32}},[a("el-col",{attrs:{span:24}},[a("div",{staticClass:"u-menu-title"},[e._v("APP商户功能菜单")]),e._v(" "),a("el-tree",{attrs:{data:e.menuTree.app_merchant,"node-key":"menuId",props:e.defaultProps}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"btn-save",attrs:{type:"primary"},on:{click:function(t){e.accessInfo_dialog=!1}}},[e._v("关闭")])],1)],1)],1)},staticRenderFns:[]};var f=a("VU/8")(u,_,!1,function(e){a("oHLn"),a("vbru")},"data-v-73008e7c",null);t.default=f.exports},vbru:function(e,t){}});
//# sourceMappingURL=34.64ca13fe84250a4c59f6.js.map