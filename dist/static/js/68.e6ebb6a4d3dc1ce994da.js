webpackJsonp([68],{AFyR:function(e,t){},FAdM:function(e,t){},bxIm:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("aA9S"),s=r.n(a),i=(r("TIfe"),r("9T2X")),o={name:"addServiceRecord",data:function(){return{pickerOptions:{shortcuts:[{text:"最近一周",onClick:function(e){var t=new Date,r=new Date;r.setTime(r.getTime()-6048e5),e.$emit("pick",[r,t])}},{text:"最近一个月",onClick:function(e){var t=new Date,r=new Date;r.setTime(r.getTime()-2592e6),e.$emit("pick",[r,t])}},{text:"最近三个月",onClick:function(e){var t=new Date,r=new Date;r.setTime(r.getTime()-7776e6),e.$emit("pick",[r,t])}}]},marketList:[],typeList:[" "],show_input:!1,typeName:"",gTicket:"",reqData:{time:[],marketCode:"",equipmentOwner:"",typeName:"",projectName:"",repairStartDate:"",repairEndDate:"",repairCost:"0.00",repairCompany:"",repairName:"",repairPhone:"",repairExplain:"",projectReport:[],checkRecord:[],comparisonRecord:[],scenePictures:[],repairContract:[],repairReceipt:[]},rules:{marketCode:[{required:!0,message:"请选择商场",trigger:"blur"}],equipmentOwner:[{required:!0,message:"请选择设备所属",trigger:"blur"}],typeName:[{required:!0,message:"请选择维护类别",trigger:"change"}],projectName:[{required:!0,message:"请输入工程项目",trigger:"blur"},{max:30,message:"工程项目不能多于30个字符",trigger:"blur"}],time:[{required:!0,message:"请选择施工时间",trigger:"blur"}],repairCost:[{required:!0,message:"请输入维护费用",trigger:"blur"},{pattern:/^\d+(\.\d{1,2})?$/,message:"请输入正确的金额(小数不可超过两位)",trigger:"blur"}],repairCompany:[{max:30,message:"施工方不能多于30个字符",trigger:"blur"}],repairName:[{max:20,message:"联系人不能多于20个字符",trigger:"blur"}],repairPhone:[{required:!1,trigger:"blur"},{pattern:/^1[34578]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}],repairExplain:[{max:120,message:"维修内容不能多于120个字符",trigger:"blur"}]},fileList:[],role:!1}},components:{selectMarket:r("LG0m").a},computed:{currentUser:function(){return this.$store.state.currentUser}},methods:{getTypeList:function(){var e=this;this.$http.get(i.a.repairType).then(function(t){t&&0==t.code?(e.typeList=t.data,0==e.typeList.length&&(e.typeList=[" "])):e.typeList=[" "]})},judegRole:function(){2===this.currentUser.affiliation?(this.reqData.marketCode=this.currentUser.marketCode,this.role=!0):this.role=!1},getMarketList:function(){var e=this;this.$http.get(i.a.marketList).then(function(t){t&&0==t.code&&t.data?e.marketList=t.data:e.marketList=[]})},repairCost_valid:function(){this.reqData.repairCost&&isNaN(this.reqData.repairCost)&&(this.reqData.repairCost="0.00")},add_type:function(){this.show_input=!this.show_input,this.typeName=""},save_addType:function(){var e=this;this.typeName=this.typeName.replace(/(^\s*)|(\s*$)/g,""),this.typeName?this.$http.post(i.a.repairType,{typeName:this.typeName}).then(function(t){t&&0==t.code&&(e.show_input=!e.show_input,e.$message({message:"保存成功",type:"success"}),e.getTypeList())}):this.$message.error("请输入内容")},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;t.reqData.equipmentOwner="商场"==t.reqData.equipmentOwner?0:1;var r=s()({},t.reqData);r.repairStartDate=r.time?r.time[0]:"",r.repairEndDate=r.time?r.time[1]:"",delete r.time,t.$http.post(i.a.operate_repair,r).then(function(e){e&&0==e.code&&(t.$message({message:"保存成功",type:"success"}),t.$store.commit("delete_tabs",t.$route),t.$router.push("/estate/seviceRecord"))})})},submitUpload:function(){this.$refs.upload.submit()},upLoadPic:function(e){var t=this;return function(r,a,s){t.reqData[e].push(r.data)}},handleRemove:function(e){var t=this;return function(r,a,s){var i=t.reqData[e];i.forEach(function(e,t){i[t].url==r.url&&i.splice(t,1)})}},handlePreview:function(e){},marketData:function(e){this.reqData.marketCode=e}},created:function(){this.gTicket=this.$store.state.gTicket,this.judegRole(),this.getTypeList(),this.getMarketList()}},l={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"contract-receipts add-service"},[r("el-form",{ref:"repaireForm",attrs:{model:e.reqData,rules:e.rules,"label-width":"140px","label-position":"right",inline:!0}},[r("el-row",{attrs:{gutter:32}},[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"商场名称",prop:"marketCode"}},[r("el-select",{attrs:{clearable:"",placeholder:"请选择",disabled:e.role},model:{value:e.reqData.marketCode,callback:function(t){e.$set(e.reqData,"marketCode",t)},expression:"reqData.marketCode"}},e._l(e.marketList,function(e,t){return r("el-option",{key:t,attrs:{label:e.marketName,value:e.marketCode}})}))],1)],1),e._v(" "),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"设备所属",prop:"equipmentOwner"}},[r("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:e.reqData.equipmentOwner,callback:function(t){e.$set(e.reqData,"equipmentOwner",t)},expression:"reqData.equipmentOwner"}},[r("el-option",{attrs:{label:"商场",value:"0"}}),e._v(" "),r("el-option",{attrs:{label:"商户",value:"1"}})],1)],1)],1)],1),e._v(" "),r("el-row",{attrs:{gutter:32}},[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"维修类别",prop:"typeName"}},[r("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:e.reqData.typeName,callback:function(t){e.$set(e.reqData,"typeName",t)},expression:"reqData.typeName"}},[e._l(e.typeList,function(e,t){return r("el-option",{key:t,attrs:{label:e,value:e}})}),e._v(" "),r("div",[e.show_input?r("el-input",{attrs:{placeholder:"请输入类别名称"},model:{value:e.typeName,callback:function(t){e.typeName="string"==typeof t?t.trim():t},expression:"typeName"}}):e._e()],1),e._v(" "),r("div",{staticClass:"select_add"},[e.show_input?r("div",[r("span",{on:{click:e.save_addType}},[e._v("保存")]),e._v(" "),r("span",{staticClass:"cancel_btn",on:{click:e.add_type}},[e._v("取消")])]):r("div",[r("i",{staticClass:"el-icon-circle-plus-outline",on:{click:e.add_type}}),e._v(" "),r("span",{on:{click:e.add_type}},[e._v("添加")])])])],2)],1)],1)],1),e._v(" "),r("el-row",{attrs:{gutter:32}},[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"工程项目",prop:"projectName"}},[r("el-input",{attrs:{clearable:"",placeholder:"项目报备名称"},model:{value:e.reqData.projectName,callback:function(t){e.$set(e.reqData,"projectName","string"==typeof t?t.trim():t)},expression:"reqData.projectName"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"施工时间",prop:"time"}},[r("el-date-picker",{attrs:{type:"daterange","picker-options":e.pickerOptions,"range-separator":"至","start-placeholder":"年/月/日","end-placeholder":"年/月/日",align:"right","value-format":"yyyy-MM-dd"},model:{value:e.reqData.time,callback:function(t){e.$set(e.reqData,"time",t)},expression:"reqData.time"}})],1)],1)],1),e._v(" "),r("el-row",{attrs:{gutter:32}},[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"维护费用",prop:"repairCost"}},[r("el-input",{attrs:{clearable:""},on:{blur:e.repairCost_valid},model:{value:e.reqData.repairCost,callback:function(t){e.$set(e.reqData,"repairCost","string"==typeof t?t.trim():t)},expression:"reqData.repairCost"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"施工方",prop:"repairCompany"}},[r("el-input",{attrs:{clearable:"",placeholder:"公司/个人"},model:{value:e.reqData.repairCompany,callback:function(t){e.$set(e.reqData,"repairCompany","string"==typeof t?t.trim():t)},expression:"reqData.repairCompany"}})],1)],1)],1),e._v(" "),r("el-row",{attrs:{gutter:32}},[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"联系人",prop:"repairName"}},[r("el-input",{attrs:{clearable:"",placeholder:"姓名"},model:{value:e.reqData.repairName,callback:function(t){e.$set(e.reqData,"repairName","string"==typeof t?t.trim():t)},expression:"reqData.repairName"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"联系方式",prop:"repairPhone"}},[r("el-input",{attrs:{clearable:"",placeholder:"手机号"},model:{value:e.reqData.repairPhone,callback:function(t){e.$set(e.reqData,"repairPhone","string"==typeof t?t.trim():t)},expression:"reqData.repairPhone"}})],1)],1)],1),e._v(" "),r("el-row",{attrs:{gutter:32}},[r("el-col",{attrs:{span:24}},[r("el-form-item",{staticClass:"otherInfo",attrs:{label:"维修内容",prop:"repairExplain"}},[r("el-input",{attrs:{type:"textarea",rows:2,placeholder:"请输入内容"},model:{value:e.reqData.repairExplain,callback:function(t){e.$set(e.reqData,"repairExplain","string"==typeof t?t.trim():t)},expression:"reqData.repairExplain\t"}})],1)],1)],1),e._v(" "),r("el-row",{attrs:{gutter:32}},[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"立项报告",prop:"projectReport"}},[r("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{action:e.$http.defaults.baseURL+"/business/property/resource","on-preview":e.handlePreview,headers:{gTicket:e.gTicket},"on-remove":e.handleRemove("projectReport"),"file-list":e.reqData.projectReport,"on-success":e.upLoadPic("projectReport")}},[r("el-button",{staticClass:"btn-80 btn-upload",attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v("浏 览")])],1)],1)],1),e._v(" "),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"验收记录",prop:"checkRecord"}},[r("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{action:e.$http.defaults.baseURL+"/business/property/resource","on-preview":e.handlePreview,headers:{gTicket:e.gTicket},"on-remove":e.handleRemove("checkRecord"),"file-list":e.reqData.checkRecord,"on-success":e.upLoadPic("checkRecord")}},[r("el-button",{staticClass:"btn-80 btn-upload",attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v("浏 览")])],1)],1)],1)],1),e._v(" "),r("el-row",{attrs:{gutter:32}},[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"比价记录",prop:"comparisonRecord"}},[r("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{action:e.$http.defaults.baseURL+"/business/property/resource","on-preview":e.handlePreview,headers:{gTicket:e.gTicket},"on-remove":e.handleRemove("comparisonRecord"),"file-list":e.reqData.comparisonRecord,"on-success":e.upLoadPic("comparisonRecord")}},[r("el-button",{staticClass:"btn-80 btn-upload",attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v("浏 览")])],1)],1)],1),e._v(" "),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"现场照片",prop:"scenePictures"}},[r("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{action:e.$http.defaults.baseURL+"/business/property/resource","on-preview":e.handlePreview,headers:{gTicket:e.gTicket},"on-remove":e.handleRemove("scenePictures"),"file-list":e.reqData.scenePictures,"on-success":e.upLoadPic("scenePictures")}},[r("el-button",{staticClass:"btn-80 btn-upload",attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v("浏 览")])],1)],1)],1)],1),e._v(" "),r("el-row",{attrs:{gutter:32}},[r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"合同",prop:"repairContract"}},[r("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{action:e.$http.defaults.baseURL+"/business/property/resource","on-preview":e.handlePreview,headers:{gTicket:e.gTicket},"on-remove":e.handleRemove("repairContract"),"file-list":e.reqData.repairContract,"on-success":e.upLoadPic("repairContract")}},[r("el-button",{staticClass:"btn-80 btn-upload",attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v("浏 览")])],1)],1)],1),e._v(" "),r("el-col",{attrs:{span:12}},[r("el-form-item",{attrs:{label:"收据",prop:"repairReceipt"}},[r("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{action:e.$http.defaults.baseURL+"/business/property/resource","on-preview":e.handlePreview,headers:{gTicket:e.gTicket},"on-remove":e.handleRemove("repairReceipt"),"file-list":e.reqData.repairReceipt,"on-success":e.upLoadPic("repairReceipt")}},[r("el-button",{staticClass:"btn-80 btn-upload",attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v("浏 览")])],1)],1)],1)],1),e._v(" "),r("el-row",[r("el-col",{attrs:{span:16}},[r("div",{staticClass:"save-div"},[r("el-button",{staticClass:"btn-save-big",on:{click:function(t){e.submitForm("repaireForm")}}},[e._v("提 交\n          ")])],1)])],1)],1)],1)},staticRenderFns:[]};var p=r("vSla")(o,l,!1,function(e){r("FAdM"),r("AFyR")},"data-v-13e11b54",null);t.default=p.exports}});
//# sourceMappingURL=68.e6ebb6a4d3dc1ce994da.js.map