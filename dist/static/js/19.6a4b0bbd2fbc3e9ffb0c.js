webpackJsonp([19],{T1iq:function(e,t){},ZWgD:function(e,t){},oC4R:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("Dd8w"),n=a.n(r),s=a("eMGh"),i=a("2A+d"),o=a("TIfe"),l={name:"addMainRecord",data:function(){return{checkEdit:"",uploadUrl:i.a.imageUpload,pickerOptions0:{disabledDate:function(e){return e.getTime()<Date.now()-864e5}},reqData:{equipmentCode:"",maintenanceCompany:"",maintenanceCost:"0.00",maintenanceId:"",maintenancePerson:"",firstId:"",rankId:"",marketCode:"",time:[(new Date).getTime(),(new Date).getTime()+6e4]},equipment:{equipmentModel:"",equipmentName:""},firstId:"",rankId:"",time:"",contractList:[],accessoryList:[],categotyListFir:[],categotyListSec:[],rules:{time:[{required:!0,message:"请选择交款起止时间",trigger:"change"}],maintenanceCost:[{validator:function(e,t,a){var r=Number(t);""===t?a(new Error("请输入维保金额")):r<=0?a(new Error("维保金额必须大于0")):/^\d+(\.\d{1,2})?$/.test(t)?a():a(new Error("请输入正确的金额格式(小数两位)"))},trigger:"blur"},{required:!0,message:"请输入维保金额",trigger:"change"}],equipmentCode:[{required:!0,message:"请选择设备编号",trigger:"change"}],firstId:[{required:!0,message:"请选择一级分类",trigger:"change"}],marketCode:[{required:!0,message:"请选择商场",trigger:"change"}],maintenanceCompany:[{max:30,message:"最多输入30个字",trigger:"blur"}],maintenancePerson:[{max:12,message:"最多输入12个字",trigger:"blur"}]},equipmentCodeList:[],marketSearch:[],role:!1}},components:{selectMarket:a("FTcF").a},created:function(){this.handleCategory("-1","categotyListFir")},computed:{gTicket:function(){return this.$store.state.gTicket}},watch:{reqData:{handler:function(e,t){""==e.marketCode&&(e.companyId=""),this.getEquipmentCodeList(e.marketCode)},deep:!0}},methods:{getMertion:function(e){var t=this;this.$http.get(i.a.equipmentCode,{params:{equipmentCode:e}}).then(function(e){e&&0==e.code&&(t.equipment=e.data)})},handleAccessoryRemove:function(e,t){this.accessoryList=t},handleContractRemove:function(e,t){this.contractList=t},handleContractList:function(e,t,a){e&&0==e.code&&e.data&&this.contractList.push(e.data)},handleAccessoryList:function(e,t,a){e&&0==e.code&&e.data&&this.accessoryList.push(e.data)},handleExceed:function(e,t){this.$message.warning("当前限制选择 3 个文件，本次选择了 "+e.length+" 个文件，共选择了 "+(e.length+t.length)+" 个文件")},beforeRemove:function(e,t){return this.$confirm("确定移除 "+e.name+"？")},beforeLogoUpload:function(e){var t="image/jpeg"===e.type||"image/png",a=e.size/1024/1024<5;return t||this.$message.error("上传图片只能是 jpg、png、jpeg、bmp格式!"),a||this.$message.error("上传图片大小不能超过5MB!"),t&&a},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;var a=Object(o.d)(t.reqData,!0,["firstId","rankId","time"]);""==t.reqData.rankId&&(t.reqData.rankId=t.reqData.firstId);var r=[];0!=t.accessoryList.length&&t.accessoryList.forEach(function(e){var t={};t.name=e.name,t.url=e.url,-1==r.indexOf(e)&&r.push(t)});var s=[];0!=t.contractList.length&&t.contractList.forEach(function(e){var t={};t.name=e.name,t.url=e.url,-1==s.indexOf(e)&&s.push(t)});var i=t.formatDateTime(t.reqData.time[0]),l=t.formatDateTime(t.reqData.time[1]),c=n()({},a,t.equipment,{rankId:t.reqData.rankId,beginTime:i,endTime:l,imgAccessoryUrl:r,imgContractUrl:s});t.handleSave("post",c)})},formatDateTime:function(e){var t=new Date(e),a=t.getFullYear(),r=t.getMonth()+1;r=r<10?"0"+r:r;var n=t.getDate();n=n<10?"0"+n:n;var s=t.getHours();s=s<10?"0"+s:s;var i=t.getMinutes(),o=t.getSeconds();return a+"-"+r+"-"+n+" "+s+":"+(i=i<10?"0"+i:i)+":"+(o=o<10?"0"+o:o)},handleSave:function(e,t){var a=this;this.$http({url:i.a.maintenance,method:e,data:t}).then(function(e){e&&(a.$message.success(e.msg),a.$router.push({name:"maintenance"}),a.$store.commit("delete_tabs",a.$route))})},handleCategory:function(e,t){var a=this;this.$http({url:s.b.deviceCategory,method:"get",params:{parentId:e}}).then(function(e){e&&0==e.code&&(e.data.length>0?(a[t]=e.data,"categotyListSec"==t&&(a.reqData.rankId=e.data[0].rankId)):(a[t]=[],a.reqData.rankId=""))})},changeSec:function(){""!=this.reqData.firstId?this.handleCategory(this.reqData.firstId,"categotyListSec"):(this.categotyListSec=[],this.reqData.rankId="")},getEquipmentCodeList:function(e){var t=this;this.$http.get(i.a.allCode,{params:{marketCode:e}}).then(function(e){e&&0==e.code&&(t.equipmentCodeList=e.data)})}}},c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"g-add-record"},[a("el-form",{ref:"reqData",staticClass:"c-search-form",attrs:{model:e.reqData,rules:e.rules,"label-width":"110px","label-position":"right",inline:!0}},[a("el-row",{attrs:{gutter:32}},[a("el-col",{attrs:{span:11,xs:24}},[a("el-form-item",{attrs:{label:"所属商场",prop:"marketCode"}},[a("select-market",{attrs:{reqData:e.reqData}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:32}},[a("el-col",{attrs:{span:11,xs:24}},[a("el-form-item",{attrs:{label:"一级分类",prop:"firstId"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择"},on:{change:e.changeSec},model:{value:e.reqData.firstId,callback:function(t){e.$set(e.reqData,"firstId",t)},expression:"reqData.firstId"}},e._l(e.categotyListFir,function(e,t){return a("el-option",{key:t,attrs:{label:e.rankName,value:e.rankId}})}))],1)],1),e._v(" "),a("el-col",{attrs:{span:11,xs:24}},[a("el-form-item",{attrs:{label:"二级分类",prop:"rankId"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.reqData.rankId,callback:function(t){e.$set(e.reqData,"rankId",t)},expression:"reqData.rankId"}},e._l(e.categotyListSec,function(e,t){return a("el-option",{key:t,attrs:{label:e.rankName,value:e.rankId}})}))],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:32}},[a("el-col",{attrs:{span:11,xs:24}},[a("el-form-item",{attrs:{label:"设备编号",prop:"equipmentCode"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择"},on:{change:e.getMertion},model:{value:e.reqData.equipmentCode,callback:function(t){e.$set(e.reqData,"equipmentCode",t)},expression:"reqData.equipmentCode"}},e._l(e.equipmentCodeList,function(e,t){return a("el-option",{key:t,attrs:{label:e.equipmentCode,value:e.equipmentCode}})}))],1)],1),e._v(" "),a("el-col",{attrs:{span:11,xs:24}},[a("el-form-item",{attrs:{label:"设备型号",prop:"equipmentModel"}},[a("el-input",{attrs:{clearable:"",disabled:""},model:{value:e.equipment.equipmentModel,callback:function(t){e.$set(e.equipment,"equipmentModel","string"==typeof t?t.trim():t)},expression:"equipment.equipmentModel"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:32}},[a("el-col",{attrs:{span:11,xs:24}},[a("el-form-item",{attrs:{label:"设备名称",prop:"equipmentName"}},[a("el-input",{attrs:{clearable:"",disabled:""},model:{value:e.equipment.equipmentName,callback:function(t){e.$set(e.equipment,"equipmentName","string"==typeof t?t.trim():t)},expression:"equipment.equipmentName"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:11,xs:24}},[a("el-form-item",{attrs:{label:"维保公司",prop:"maintenanceCompany"}},[a("el-input",{attrs:{clearable:""},model:{value:e.reqData.maintenanceCompany,callback:function(t){e.$set(e.reqData,"maintenanceCompany","string"==typeof t?t.trim():t)},expression:"reqData.maintenanceCompany"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:32}},[a("el-col",{attrs:{span:11,xs:24}},[a("el-form-item",{attrs:{label:"维保金额\n                  ",prop:"maintenanceCost"}},[a("el-input",{attrs:{clearable:"",placeholder:"0.00"},model:{value:e.reqData.maintenanceCost,callback:function(t){e.$set(e.reqData,"maintenanceCost","string"==typeof t?t.trim():t)},expression:"reqData.maintenanceCost"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:11,xs:24}},[a("el-form-item",{attrs:{label:"维保人\n                  ",prop:"maintenancePerson"}},[a("el-input",{attrs:{clearable:""},model:{value:e.reqData.maintenancePerson,callback:function(t){e.$set(e.reqData,"maintenancePerson","string"==typeof t?t.trim():t)},expression:"reqData.maintenancePerson"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:32}},[a("el-col",{attrs:{span:11}},[a("el-form-item",{attrs:{label:"维保时间",prop:"time"}},[a("el-date-picker",{attrs:{type:"datetimerange","picker-options":e.pickerOptions0,"range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"timestamp","default-time":["00:00:00","23:59:59"],align:"right"},model:{value:e.reqData.time,callback:function(t){e.$set(e.reqData,"time",t)},expression:"reqData.time"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:32}},[a("el-col",{attrs:{span:11,xs:24}},[a("el-form-item",{attrs:{label:"维保附件\n",prop:"accessoryList"}},[a("el-upload",{staticClass:"upload-demo",attrs:{action:e.$http.defaults.baseURL+e.uploadUrl,"before-remove":e.beforeRemove,multiple:"",limit:10,"on-remove":e.handleAccessoryRemove,"on-exceed":e.handleExceed,headers:{gTicket:e.gTicket},"file-list":e.accessoryList,"on-success":e.handleAccessoryList,"before-upload":e.beforeLogoUpload}},[a("el-button",{staticClass:"btn-80 btn-upload",attrs:{size:"small",type:"primary"}},[e._v("浏览")])],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:32}},[a("el-col",{attrs:{span:11,xs:24}},[a("el-form-item",{attrs:{label:"维保合同\n",prop:"contractList"}},[a("el-upload",{staticClass:"upload-demo",attrs:{action:e.$http.defaults.baseURL+e.uploadUrl,"before-remove":e.beforeRemove,multiple:"",limit:10,"on-remove":e.handleContractRemove,"on-exceed":e.handleExceed,"file-list":e.contractList,headers:{gTicket:e.gTicket},"on-success":e.handleContractList,"before-upload":e.beforeLogoUpload}},[a("el-button",{staticClass:"btn-80 btn-upload",attrs:{size:"small",type:"primary"}},[e._v("浏览")])],1)],1)],1)],1),e._v(" "),a("el-row",{staticClass:"u-button",attrs:{gutter:32}},[a("el-col",{attrs:{span:8,offset:16}},[a("el-button",{staticClass:" btn-save-big",attrs:{type:"primary"},on:{click:function(t){e.submitForm("reqData")}}},[e._v("保存")])],1)],1)],1)],1)},staticRenderFns:[]};var m=a("VU/8")(l,c,!1,function(e){a("ZWgD"),a("T1iq")},null,null);t.default=m.exports}});
//# sourceMappingURL=19.6a4b0bbd2fbc3e9ffb0c.js.map