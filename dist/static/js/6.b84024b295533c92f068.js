webpackJsonp([6],{"+4C+":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i("woOf"),n=i.n(r),s=i("Dd8w"),a=i.n(s),o=i("hVDB"),l=i("khD/"),c=i("NYxO"),u={name:"editContent",computed:a()({},Object(c.d)(["gTicket"])),components:{Tinymce:l.a},data:function(){return{uploadUrl:"",uploadHeaders:{gTicket:""},channels:[{code:1,desc:"App首页"}],rules:{title:[{required:!0,message:"请输入文章标题",trigger:"blur"},{min:1,max:30,message:"长度1-30 个字符",trigger:"blur"}],subtitle:[{required:!1,min:1,max:20,message:"长度1-20 个字符",trigger:"blur"}],releaseChannelList:[{required:!0,message:"请选择发布渠道",trigger:"change"}],coverImageUrl:[{required:!0,message:"请上传封面图",trigger:"change"}],author:[{required:!0,message:"请输入作者",trigger:"blur"},{min:1,max:10,message:"长度1-10 个字符",trigger:"blur"}],contentAbstract:[{required:!0,message:"请输入摘要",trigger:"blur"},{min:1,max:120,message:"长度1-120 个字符",trigger:"blur"}],contentType:[{required:!0,message:"请选择类型",trigger:"change"}],link:[{required:!0,message:"请输入链接",trigger:"blur"}]},ruleForm:{title:"",subtitle:"",releaseChannelList:[],coverImageUrl:"",author:"",contentAbstract:"",contentType:"",link:"",content:""}}},methods:{beforeImgUpload:function(e){var t=e.size/1024/1024<=20;return t||this.$message.error("上传头像图片大小不能超过20MB!"),t},coverImageUpload:function(e){this.ruleForm.coverImageUrl=e.data},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;console.log(t.ruleForm),t.$http.put(o.a.addContent+"/"+t.ruleForm.contentCode,t.ruleForm).then(function(e){0===e.code?(t.$message.success(e.msg),t.$router.push({path:"/operation/content"})):t.$message.error(e.msg)})})},getOneData:function(){var e=this,t=this.$route.params.id;this.$http.get(o.a.singleContent+"/"+t).then(function(t){if(0===t.code){n()(e.ruleForm,t.data);for(var i=a()({},e.ruleForm),r=i.releaseChannel,s=[],o=0;o<r.length;o++)s.push(r[o].code);e.ruleForm.releaseChannelList=[],e.ruleForm.releaseChannelList=[].concat(s),e.ruleForm.contentType=i.contentType.code+"",console.log(e.ruleForm)}})},resetForm:function(e){this.$refs[e].resetFields()}},beforeMount:function(){this.getOneData(),this.uploadUrl=this.$http.defaults.baseURL+"/business/operation/image/upload",this.uploadHeaders.gTicket=this.gTicket}},d={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"contract-receipts add-content"},[i("div",{staticClass:"main-title"},[e._v("\n    编辑内容")]),e._v(" "),i("br"),e._v(" "),i("el-form",{ref:"ruleForm",staticClass:"c-search-form",attrs:{rules:e.rules,model:e.ruleForm,"label-width":"102px",inline:!0,"label-position":"right"}},[i("div",[i("el-form-item",{attrs:{label:"文章标题",prop:"title"}},[i("el-input",{attrs:{clearable:""},model:{value:e.ruleForm.title,callback:function(t){e.$set(e.ruleForm,"title","string"==typeof t?t.trim():t)},expression:"ruleForm.title"}})],1)],1),e._v(" "),i("div",[i("el-form-item",{staticClass:"second-title",attrs:{label:"副标题",prop:"subtitle"}},[i("el-input",{attrs:{clearable:""},model:{value:e.ruleForm.subtitle,callback:function(t){e.$set(e.ruleForm,"subtitle","string"==typeof t?t.trim():t)},expression:"ruleForm.subtitle"}})],1)],1),e._v(" "),i("div",[i("el-form-item",{staticClass:"second-title",attrs:{label:"发布渠道",prop:"releaseChannelList"}},[i("el-select",{attrs:{multiple:"",placeholder:"请选择"},model:{value:e.ruleForm.releaseChannelList,callback:function(t){e.$set(e.ruleForm,"releaseChannelList","string"==typeof t?t.trim():t)},expression:"ruleForm.releaseChannelList"}},e._l(e.channels,function(e){return i("el-option",{key:e.code,attrs:{label:e.desc,value:e.code}})}))],1)],1),e._v(" "),i("div",[i("el-form-item",{attrs:{label:"封面图",prop:"coverImageUrl"}},[i("el-upload",{staticClass:"avatar-uploader",attrs:{headers:e.uploadHeaders,action:e.uploadUrl,accept:"image/jpg,image/jpeg,image/png,image/bmp,image/gif","show-file-list":!1,"before-upload":e.beforeImgUpload,"on-success":e.coverImageUpload}},[e.ruleForm.coverImageUrl?i("img",{staticClass:"avatar",attrs:{src:e.ruleForm.coverImageUrl}}):i("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1)],1),e._v(" "),i("div",[i("el-form-item",{staticClass:"author",attrs:{label:"作者",prop:"author"}},[i("el-input",{attrs:{clearable:""},model:{value:e.ruleForm.author,callback:function(t){e.$set(e.ruleForm,"author","string"==typeof t?t.trim():t)},expression:"ruleForm.author"}})],1)],1),e._v(" "),i("div",[i("el-form-item",{attrs:{label:"摘要",prop:"contentAbstract"}},[i("el-input",{attrs:{type:"textarea",rows:5,placeholder:"请输入内容",clearable:""},model:{value:e.ruleForm.contentAbstract,callback:function(t){e.$set(e.ruleForm,"contentAbstract","string"==typeof t?t.trim():t)},expression:"ruleForm.contentAbstract"}})],1)],1),e._v(" "),i("div",[i("el-form-item",{attrs:{label:"正文类型",prop:"contentType"}},[i("el-radio-group",{model:{value:e.ruleForm.contentType,callback:function(t){e.$set(e.ruleForm,"contentType","string"==typeof t?t.trim():t)},expression:"ruleForm.contentType"}},[i("el-radio",{attrs:{label:"1"}},[e._v("链接")]),e._v(" "),i("el-radio",{attrs:{label:"2"}},[e._v("图文")])],1)],1)],1),e._v(" "),"1"===e.ruleForm.contentType?i("div",[i("el-form-item",{attrs:{label:"文章链接",prop:"link"}},[i("el-input",{attrs:{clearable:""},model:{value:e.ruleForm.link,callback:function(t){e.$set(e.ruleForm,"link","string"==typeof t?t.trim():t)},expression:"ruleForm.link"}})],1)],1):i("div",{staticClass:"editor-container-wrap"},[i("Tinymce",{ref:"editor",attrs:{height:400},model:{value:e.ruleForm.content,callback:function(t){e.$set(e.ruleForm,"content","string"==typeof t?t.trim():t)},expression:"ruleForm.content"}})],1),e._v(" "),i("div",{staticClass:"save-btn"},[i("el-button",{staticClass:"btn-save-big",attrs:{type:"primary",icon:"el-icon-save"},on:{click:function(t){e.submitForm("ruleForm")}}},[e._v("保存")])],1)])],1)},staticRenderFns:[]};var m=i("VU/8")(u,d,!1,function(e){i("Vvhe"),i("qynu")},"data-v-e53dd688",null);t.default=m.exports},Fit5:function(e,t){},Vvhe:function(e,t){},"khD/":function(e,t,i){"use strict";var r=i("//Fk"),n=i.n(r),s=i("fZjL"),a=i.n(s),o=i("Dd8w"),l=i.n(o),c=i("NYxO"),u={computed:l()({},Object(c.d)(["gTicket"])),name:"editorSlideUpload",props:{color:{type:String,default:"#1890ff"}},data:function(){return{uploadUrl:"",uploadHeaders:{gTicket:""},dialogVisible:!1,listObj:{},fileList:[]}},methods:{checkAllSuccess:function(){var e=this;return a()(this.listObj).every(function(t){return e.listObj[t].hasSuccess})},handleSubmit:function(){var e=this,t=a()(this.listObj).map(function(t){return e.listObj[t]});this.checkAllSuccess()?(console.log(t),this.$emit("successCBK",t),this.listObj={},this.fileList=[],this.dialogVisible=!1):this.$message("请等待所有图片上传成功 或 出现了网络问题，请刷新页面重新上传！")},handleSuccess:function(e,t){for(var i=t.uid,r=a()(this.listObj),n=0,s=r.length;n<s;n++)if(this.listObj[r[n]].uid===i)return this.listObj[r[n]].url=e.data,void(this.listObj[r[n]].hasSuccess=!0)},handleRemove:function(e){for(var t=e.uid,i=a()(this.listObj),r=0,n=i.length;r<n;r++)if(this.listObj[i[r]].uid===t)return void delete this.listObj[i[r]]},beforeUpload:function(e){var t=e.size/1024/1024<=20;if(!t)return this.$message.error("上传头像图片大小不能超过20MB!"),t;var i=this,r=window.URL||window.webkitURL,s=e.uid;return this.listObj[s]={},new n.a(function(t,n){var a=new Image;a.src=r.createObjectURL(e),a.onload=function(){i.listObj[s]={hasSuccess:!1,uid:e.uid,width:this.width,height:this.height}},t(!0)})}},beforeMount:function(){this.uploadUrl=this.$http.defaults.baseURL+"/business/operation/image/upload",this.uploadHeaders.gTicket=this.gTicket}},d={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"upload-container"},[i("el-button",{style:{background:e.color,borderColor:e.color},attrs:{icon:"el-icon-upload",size:"mini",type:"primary"},on:{click:function(t){e.dialogVisible=!0}}},[e._v("上传图片\n  ")]),e._v(" "),i("el-dialog",{attrs:{"append-to-body":"",visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("el-upload",{staticClass:"editor-slide-upload",attrs:{headers:e.uploadHeaders,action:e.uploadUrl,"file-list":e.fileList,"show-file-list":!0,"list-type":"picture-card","on-remove":e.handleRemove,"on-success":e.handleSuccess,"before-upload":e.beforeUpload}},[i("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")])],1),e._v(" "),i("el-button",{staticClass:"btn-search btn-reset",attrs:{type:"primary"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{staticClass:"btn-search btn-save",attrs:{type:"primary"},on:{click:e.handleSubmit}},[e._v("确 定")])],1)],1)},staticRenderFns:[]};var m=["advlist anchor autolink autosave code codesample colorpicker colorpicker contextmenu directionality emoticons fullscreen hr image imagetools importcss insertdatetime link lists media nonbreaking noneditable pagebreak paste preview print save searchreplace spellchecker tabfocus table template textcolor textpattern visualblocks visualchars wordcount"],h=["bold italic underline strikethrough alignleft aligncenter alignright outdent indent  blockquote undo redo removeformat subscript superscript code codesample","hr bullist numlist link image charmap\t preview anchor pagebreak insertdatetime media table emoticons forecolor backcolor fullscreen"],p={name:"tinymce",components:{editorImage:i("VU/8")(u,d,!1,function(e){i("Fit5")},null,null).exports},props:{id:{type:String},value:{type:String,default:""},toolbar:{type:Array,required:!1,default:function(){return[]}},menubar:{default:"file edit insert view format table"},height:{type:Number,required:!1,default:360}},data:function(){return{hasChange:!1,hasInit:!1,tinymceId:this.id||"vue-tinymce-"+ +new Date,fullscreen:!1}},watch:{value:function(e){var t=this;!this.hasChange&&this.hasInit&&this.$nextTick(function(){return window.tinymce.get(t.tinymceId).setContent(e||"")})}},mounted:function(){this.initTinymce()},activated:function(){this.initTinymce()},deactivated:function(){this.destroyTinymce()},methods:{initTinymce:function(){var e=this,t=this;window.tinymce.init({selector:"#"+this.tinymceId,height:this.height,body_class:"panel-body ",object_resizing:!1,toolbar:this.toolbar.length>0?this.toolbar:h,menubar:this.menubar,plugins:m,end_container_on_empty_block:!0,powerpaste_word_import:"clean",code_dialog_height:450,code_dialog_width:1e3,advlist_bullet_styles:"square",advlist_number_styles:"default",imagetools_cors_hosts:["www.tinymce.com","codepen.io"],default_link_target:"_blank",link_title:!1,nonbreaking_force_tab:!0,init_instance_callback:function(i){t.value&&i.setContent(t.value),t.hasInit=!0,i.on("NodeChange Change KeyUp SetContent",function(){e.hasChange=!0,e.$emit("input",i.getContent())})},setup:function(e){e.on("FullscreenStateChanged",function(e){t.fullscreen=e.state})}})},destroyTinymce:function(){window.tinymce.get(this.tinymceId)&&window.tinymce.get(this.tinymceId).destroy()},setContent:function(e){window.tinymce.get(this.tinymceId).setContent(e)},getContent:function(){window.tinymce.get(this.tinymceId).getContent()},imageSuccessCBK:function(e){var t=this;e.forEach(function(e){window.tinymce.get(t.tinymceId).insertContent('<img class="wscnph" src="'+e.url+'" >')})}},destroyed:function(){this.destroyTinymce()}},g={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"tinymce-container editor-container",class:{fullscreen:this.fullscreen}},[t("textarea",{staticClass:"tinymce-textarea",attrs:{id:this.tinymceId}}),this._v(" "),t("div",{staticClass:"editor-custom-btn-container"},[t("editorImage",{staticClass:"editor-upload-btn",attrs:{color:"#1890ff"},on:{successCBK:this.imageSuccessCBK}})],1)])},staticRenderFns:[]};var b=i("VU/8")(p,g,!1,function(e){i("pbWW")},"data-v-6bd0c284",null);t.a=b.exports},pbWW:function(e,t){},qynu:function(e,t){}});
//# sourceMappingURL=6.b84024b295533c92f068.js.map