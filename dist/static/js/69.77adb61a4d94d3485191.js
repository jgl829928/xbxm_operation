webpackJsonp([69],{DZQc:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=a("UpQb"),r=a("hm3b"),s=a("FTcF"),l={name:"boothGroupe",components:{Pagenation:r.a,selectMarket:s.a},computed:{currentUser:function(){return this.$store.state.currentUser}},data:function(){return{boothNoList:[],boothNoValue:[],centerDialogVisible:!1,innerVisible:!1,particularsVisible:!1,affiliation:2,pageDefault:{totalRecords:0,currentPage:1,pageSize:20},marketInfo:{marketName:"龙泉商场",marketCode:"51000001"},title:"摊位组-新增",formType:"add",boothGroupsCode:"",pageParams:{boothGroupsName:"",manager:"",marketCode:"",groupsStatus:"",currentPage:1},marketNameOption:[],statusList:[{label:"启用",value:1},{label:"停用",value:0}],managerList:[],particularsData:{},ruleForm:{groupsStatus:1,boothGroupsName:"",boothNumber:"",marketCode:"",marketName:"",managerCode:"",manager:""},rules:{boothGroupsName:[{required:!0,message:"请输入摊位组名称",trigger:"blur"}],manager:[{required:!0,message:"请选择楼层经理",trigger:"change"}],marketCode:[{required:!0,message:"请选择商场",trigger:"change"}],boothNumber:[{required:!0,message:"请输入摊位编号",trigger:"change"}]},itemList:[],floorList:["全部"],floorStatus:""}},mounted:function(){var t=this,e=this;this.groupingList(),this.marketInfo=this.currentUser,1==this.currentUser.affiliation?(this.affiliation=1,this.$http.get(o.a.marketsName,{params:{areaCode:""}}).then(function(e){0===e.code&&(t.marketNameOption=e.data)})):(this.affiliation=2,this.ruleForm.marketName=this.marketInfo.marketName,this.ruleForm.marketCode=this.marketInfo.marketCode,this.$http.get(o.a.floorManagers,{params:{marketCodes:"["+e.marketInfo.marketCode+"]"}}).then(function(t){0===t.code&&(e.managerList=t.data)}))},methods:{marketChange:function(t){var e=this;e.ruleForm.boothNumber="",e.ruleForm.manager="",e.boothNoValue=[],this.$http.get(o.a.floorManagers,{params:{marketCodes:"["+t+"]"}}).then(function(t){0===t.code&&(e.managerList=t.data)}),e.marketNameOption.forEach(function(a){a.marketCode==t&&(e.marketInfo.marketName=a.marketName,e.marketInfo.marketCode=t)})},rightControl:function(t){return this.$store.getters.getPermission(t)},selectVal:function(t){var e=this;e.managerList.forEach(function(a,o){t==a.employeeName&&(e.ruleForm.manager=a.employeeName,e.ruleForm.managerCode=a.empId)})},reset:function(){this.centerDialogVisible=!1,this.$refs.ruleForm.resetFields(),this.$refs.ruleForm.clearValidate()},groupingList:function(t){var e=this;this.pageParams.currentPage=t||1,this.$http.get(o.a.boothGroups,{params:this.pageParams}).then(function(t){0===t.code&&(e.pageDefault.totalRecords=t.page.totalRecords,e.itemList=t.data)})},Dialog:function(t,e){var a=this,r=this;this.centerDialogVisible=!0,r.boothNoList=[],r.boothNoValue=[],"add"==t?(this.title="摊位组-添加",this.formType="add",setTimeout(function(){2==r.affiliation?(r.ruleForm.marketCode=r.marketInfo.marketCode,r.ruleForm.marketName=r.marketInfo.marketName):r.marketInfo={},r.ruleForm.groupsStatus=1,r.$refs.ruleForm.clearValidate()},100)):(this.title="摊位组-修改",this.formType="edit",this.boothGroupsCode=e,this.$http.get(o.a.boothParticulars,{params:{boothGroupsCode:e}}).then(function(t){0===t.code&&(r.ruleForm=t.data,r.boothNoValue=t.data.boothNumber.split(","),a.marketInfo.marketName=t.data.marketName,a.marketInfo.marketCode=t.data.marketCode,1==r.affiliation&&r.$http.get(o.a.floorManagers,{params:{marketCodes:"["+r.ruleForm.marketCode+"]"}}).then(function(t){0===t.code&&(r.managerList=t.data)}))}))},del:function(t){var e=this,a=this;this.$confirm("确认删除？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$http.delete(o.a.boothGroups,{params:{boothGroupsCode:t}}).then(function(t){0===t.code&&(e.$message.success("删除成功"),a.groupingList())})}).catch(function(){e.$message({type:"info",message:"已取消删除"})})},boothNoSubmit:function(){this.ruleForm.boothNumber=this.boothNoValue.join(","),this.innerVisible=!1},boothSelect:function(){var t=this;this.innerVisible=!0,t.boothNoList=[],this.$http.get(o.a.marketFloor,{params:{marketCode:t.marketInfo.marketCode}}).then(function(e){0===e.code&&(t.floorList=e.data.floors.split(","),t.floorList.unshift("全部"))}),this.$http.get(o.a.boothList,{params:{marketCode:t.marketInfo.marketCode,floor:""}}).then(function(e){if(0===e.code){for(var a=0;a<e.data.length;a++)t.boothNoList.push({key:e.data[a].boothNumber,label:e.data[a].boothNumber});for(var o=0;o<t.boothNoValue.length;o++)t.boothNoList.push({key:t.boothNoValue[o],label:t.boothNoValue[o]})}})},selectFloor:function(t){var e=this,a=t;"全部"==a&&(a=""),e.boothNoList=[],this.$http.get(o.a.boothList,{params:{marketCode:e.marketInfo.marketCode,floor:a}}).then(function(t){if(0===t.code)for(var a=0;a<t.data.length;a++)e.boothNoList.push({key:t.data[a].boothNumber,label:t.data[a].boothNumber})})},particulars:function(t){this.particularsVisible=!0;var e=this;this.$http.get(o.a.boothParticulars,{params:{boothGroupsCode:t}}).then(function(t){0===t.code&&(e.particularsData=t.data)})},submitForm:function(t){var e=this,a=this;this.$refs[t].validate(function(t){if(t){var r="";"add"==a.formType?(r="添加成功",e.$http({url:o.a.boothGroups,method:"post",data:a.ruleForm,delayLoading:!1}).then(function(t){0===t.code&&(e.$message.success(r),a.centerDialogVisible=!1,a.groupingList(),a.boothNoList=[],a.boothNoValue=[])})):(r="修改成功",a.ruleForm.boothGroupsCode=a.boothGroupsCode,e.$http.put(o.a.boothGroups,a.ruleForm).then(function(t){0===t.code&&(e.$message.success(r),a.centerDialogVisible=!1,a.groupingList(),a.boothNoList=[],a.boothNoValue=[])}))}})},indexMethod:function(t){return t+20*(this.pageParams.currentPage-1)+1}}},i={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"booth-grouping"},[a("el-form",{ref:"pageParams",staticClass:"c-search-form",attrs:{model:t.pageParams,"label-width":"102px","label-position":"right",inline:!0}},[a("el-row",{attrs:{gutter:32}},[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"摊位组名称"}},[a("el-input",{attrs:{clearable:""},model:{value:t.pageParams.boothGroupsName,callback:function(e){t.$set(t.pageParams,"boothGroupsName","string"==typeof e?e.trim():e)},expression:"pageParams.boothGroupsName"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"楼层经理"}},[a("el-input",{attrs:{clearable:""},model:{value:t.pageParams.manager,callback:function(e){t.$set(t.pageParams,"manager","string"==typeof e?e.trim():e)},expression:"pageParams.manager"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"商场名称"}},[a("selectMarket",{attrs:{reqData:t.pageParams}})],1)],1)],1),t._v(" "),a("el-row",{attrs:{gutter:32}},[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"状态"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:t.pageParams.groupsStatus,callback:function(e){t.$set(t.pageParams,"groupsStatus","string"==typeof e?e.trim():e)},expression:"pageParams.groupsStatus"}},t._l(t.statusList,function(t,e){return a("el-option",{key:e,attrs:{label:t.label,value:t.value}})}))],1)],1),t._v(" "),a("el-col",{attrs:{span:8,offset:8}},[a("div",{staticClass:"c-footer-btn"},[a("el-button",{staticClass:"btn-search",attrs:{type:"primary",icon:"el-icon-search"},on:{click:function(e){t.groupingList(1)}}},[t._v("查询")])],1)])],1)],1),t._v(" "),a("div",[a("el-button",{directives:[{name:"show",rawName:"v-show",value:t.rightControl("boothGroupe_4"),expression:"rightControl('boothGroupe_4')"}],staticClass:"btn-search btn-add",attrs:{type:"primary"},on:{click:function(e){t.Dialog("add")}}},[t._v("添加")])],1),t._v(" "),a("div",{staticClass:"c-table-wrap"},[a("el-table",{staticStyle:{width:"100% !important"},attrs:{data:t.itemList,align:"center",stripe:"",height:"500"}},[a("el-table-column",{attrs:{align:"center",type:"index",label:"序号",width:"50"}}),t._v(" "),a("el-table-column",{attrs:{align:"center",prop:"boothGroupsName",label:"摊位组名称",minWidth:"120"}}),t._v(" "),a("el-table-column",{attrs:{align:"center",prop:"marketName",label:"商场名称",width:"120"}}),t._v(" "),a("el-table-column",{attrs:{align:"center",prop:"manager",label:"楼层经理",width:"120"}}),t._v(" "),a("el-table-column",{attrs:{align:"center",prop:"groupsStatus",label:"状态",width:"110"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\r\n          "+t._s(1==e.row.groupsStatus?"启用":"停用")+"\r\n        ")]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",prop:"updateTime",label:"最后修改时间",width:"165"}}),t._v(" "),a("el-table-column",{attrs:{align:"center",prop:"operatorName",label:"最后修改人",width:"120"}}),t._v(" "),a("el-table-column",{attrs:{align:"center",width:"300",label:"操作",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{staticClass:"btn-handle",attrs:{type:"primary",disabled:!t.rightControl("boothGroupe_2")},on:{click:function(a){t.particulars(e.row.boothGroupsCode)}}},[t._v("详情")]),t._v(" "),a("el-button",{staticClass:"btn-handle",attrs:{type:"primary",disabled:!t.rightControl("boothGroupe_3")||1==e.row.groupsStatus},on:{click:function(a){t.Dialog("edit",e.row.boothGroupsCode)}}},[t._v("修改")]),t._v(" "),a("el-button",{staticClass:"btn-handle btn-add",attrs:{type:"primary",disabled:!t.rightControl("boothGroupe_5")||1==e.row.groupsStatus},on:{click:function(a){t.del(e.row.boothGroupsCode)}}},[t._v("删除")])]}}])})],1)],1),t._v(" "),a("Pagenation",{attrs:{pageparams:t.pageDefault,itemList:t.itemList},on:{handlePage:t.groupingList}}),t._v(" "),a("el-dialog",{staticClass:"l-dialog",attrs:{title:t.title,visible:t.centerDialogVisible},on:{"update:visible":function(e){t.centerDialogVisible=e},close:t.reset}},[a("el-dialog",{staticClass:"l-dialog booth-dialog",attrs:{width:"30%",title:"选择摊位",visible:t.innerVisible,"append-to-body":""},on:{"update:visible":function(e){t.innerVisible=e}}},[a("el-form",{attrs:{"label-width":"100px"}},[a("el-row",{attrs:{gutter:32}},[a("el-col",{attrs:{span:12,xs:24}},[a("el-form-item",{attrs:{label:"商场名称"}},[a("span",{staticClass:"gray"},[t._v(t._s(t.marketInfo.marketName))])])],1),t._v(" "),a("el-col",{attrs:{span:12,xs:24}},[a("el-form-item",{attrs:{label:"楼层"}},[a("el-select",{attrs:{clearable:"",placeholder:"全部层"},on:{change:t.selectFloor},model:{value:t.floorStatus,callback:function(e){t.floorStatus="string"==typeof e?e.trim():e},expression:"floorStatus"}},t._l(t.floorList,function(t,e){return a("el-option",{key:e,attrs:{label:t+"层",value:t}})}))],1)],1)],1)],1),t._v(" "),a("el-transfer",{staticClass:"booth-dialogTransfer",attrs:{data:t.boothNoList},model:{value:t.boothNoValue,callback:function(e){t.boothNoValue=e},expression:"boothNoValue"}}),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"btn-primary btn-save",attrs:{type:"primary"},on:{click:t.boothNoSubmit}},[t._v("保 存")]),t._v(" "),a("el-button",{staticClass:"btn-primary btn-reset",attrs:{type:"primary"},on:{click:function(e){t.innerVisible=!1}}},[t._v("取 消")])],1)],1),t._v(" "),a("div",[a("el-form",{ref:"ruleForm",attrs:{rules:t.rules,model:t.ruleForm,"label-width":"100px"}},[a("el-row",{attrs:{gutter:32}},[a("el-col",{attrs:{span:12,xs:24}},[a("el-form-item",{attrs:{label:"摊位组名称",prop:"boothGroupsName"}},[a("el-input",{attrs:{clearable:"",maxlength:"50"},model:{value:t.ruleForm.boothGroupsName,callback:function(e){t.$set(t.ruleForm,"boothGroupsName","string"==typeof e?e.trim():e)},expression:"ruleForm.boothGroupsName"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:12,xs:24}},[2==t.affiliation?a("el-form-item",{attrs:{label:"商场名称"}},[a("span",{staticClass:"gray"},[t._v(t._s(t.ruleForm.marketName))])]):t._e(),t._v(" "),1==t.affiliation?a("el-form-item",{attrs:{label:"商场名称",prop:"marketCode"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择"},on:{change:t.marketChange},model:{value:t.ruleForm.marketCode,callback:function(e){t.$set(t.ruleForm,"marketCode",e)},expression:"ruleForm.marketCode"}},t._l(t.marketNameOption,function(t,e){return a("el-option",{key:e,attrs:{label:t.marketName,value:t.marketCode}})}))],1):t._e()],1)],1),t._v(" "),a("el-row",{attrs:{gutter:32}},[1==t.affiliation&&t.ruleForm.marketCode||2==t.affiliation?a("el-col",{attrs:{span:12,xs:24}},[a("el-form-item",{attrs:{label:"楼层经理",prop:"manager"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择"},on:{change:t.selectVal},model:{value:t.ruleForm.manager,callback:function(e){t.$set(t.ruleForm,"manager","string"==typeof e?e.trim():e)},expression:"ruleForm.manager"}},t._l(t.managerList,function(t,e){return a("el-option",{key:e,attrs:{label:t.employeeName,value:t.employeeName}})}))],1)],1):t._e(),t._v(" "),1==t.affiliation&&t.ruleForm.marketCode||2==t.affiliation?a("el-col",{attrs:{span:12,xs:24}},[a("el-form-item",{attrs:{label:"摊位编号",prop:"boothNumber"}},[a("el-input",{on:{focus:t.boothSelect},model:{value:t.ruleForm.boothNumber,callback:function(e){t.$set(t.ruleForm,"boothNumber","string"==typeof e?e.trim():e)},expression:"ruleForm.boothNumber"}})],1)],1):t._e()],1),t._v(" "),a("el-form-item",{attrs:{label:"状态"}},[a("el-radio-group",{model:{value:t.ruleForm.groupsStatus,callback:function(e){t.$set(t.ruleForm,"groupsStatus","string"==typeof e?e.trim():e)},expression:"ruleForm.groupsStatus"}},[a("el-radio",{staticClass:"gray",attrs:{label:1}},[t._v("启用")]),t._v(" "),a("el-radio",{staticClass:"gray",attrs:{label:0}},[t._v("停用")])],1)],1)],1)],1),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"btn-primary btn-save",attrs:{type:"primary"},on:{click:function(e){t.submitForm("ruleForm")}}},[t._v("保 存")]),t._v(" "),a("el-button",{staticClass:"btn-primary btn-reset",attrs:{type:"primary"},on:{click:t.reset}},[t._v("取 消")])],1)],1),t._v(" "),a("el-dialog",{staticClass:"l-dialog",attrs:{width:"30%",title:"摊位组-详情",visible:t.particularsVisible},on:{"update:visible":function(e){t.particularsVisible=e}}},[a("el-form",{attrs:{"label-width":"100px"}},[a("el-row",{attrs:{gutter:32}},[a("el-col",{attrs:{span:12,xs:24}},[a("el-form-item",{attrs:{label:"摊位组名称"}},[a("span",{staticClass:"gray"},[t._v(t._s(t.particularsData.boothGroupsName))])])],1),t._v(" "),a("el-col",{attrs:{span:12,xs:24}},[a("el-form-item",{attrs:{label:"商场名称"}},[a("span",{staticClass:"gray"},[t._v(t._s(t.particularsData.marketName))])])],1),t._v(" "),a("el-col",{attrs:{span:12,xs:24}},[a("el-form-item",{attrs:{label:"楼层经理"}},[a("span",{staticClass:"gray"},[t._v(t._s(t.particularsData.manager))])])],1),t._v(" "),a("el-col",{attrs:{span:12,xs:24}},[a("el-form-item",{attrs:{label:"状态"}},[a("span",{staticClass:"gray"},[t._v(t._s(1==t.particularsData.groupsStatus?"启用":"禁用"))])])],1),t._v(" "),a("el-col",{attrs:{span:12,xs:24}},[a("el-form-item",{attrs:{label:"摊位号"}},[a("span",{staticClass:"gray"},[t._v(t._s(t.particularsData.boothNumber))])])],1)],1)],1),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"btn-primary btn-reset",attrs:{type:"primary"},on:{click:function(e){t.particularsVisible=!1}}},[t._v("关 闭")])],1)],1)],1)},staticRenderFns:[]};var n=a("vSla")(l,i,!1,function(t){a("zqmI"),a("orsS")},"data-v-12fd710e",null);e.default=n.exports},orsS:function(t,e){},zqmI:function(t,e){}});
//# sourceMappingURL=69.77adb61a4d94d3485191.js.map