webpackJsonp([23],{"1miJ":function(e,t){},UKVe:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=a("woOf"),s=a.n(l),o=a("mfbU"),r=(a("LG0m"),{data:function(){return{gTicket:"",upload_url:o.a.upload_employeesInfo,allRole:[],reqData:{available:"",currentPage:1,employeeName:"",employeeType:"",marketCode:"",merchantCode:"",mobile:"",pageSize:20},marketList:[],roleList:[],merchantList:[],itemList:[],pageparams:{},rules:{},radio2:"",statusList:[],add_dialog:!1,dialog_title:"员工信息-添加",add_data:{available:1,employeeName:"",employeeType:1,marketCode:"",marketName:"",merchantCode:"",merchantName:"",mobile:"",roleIds:[]},add_rules:{employeeName:[{required:!0,message:"请输入员工姓名",trigger:"blur"},{max:32,message:"角色名称不能多于32个字符",trigger:"blur"}],mobile:[{required:!0,message:"请输入手机号",trigger:"blur"},{validator:function(e,t,a){t&&(0==/^1[34578]\d{9}$/.test(t)?a(new Error("请输入正确的手机号")):a())},trigger:"blur"}],roleIds:[{required:!0,message:"请选择角色",trigger:"change"}],marketCode:[{required:!0,message:"请选择商场",trigger:"change"}]},editId:"",accessInfo_dialog:!1,person_info:{},app_merchant:[],app_operate:[],operate:[],defaultProps:{children:"list",label:"name"}}},components:{pagenation:a("hm3b").a},name:"personnelMain",methods:{getListData:function(){var e=this;this.$http.get(o.a.employees,{params:this.reqData}).then(function(t){t&&0==t.code&&t.data?(e.itemList=t.data,e.pageparams=t.page,e.itemList&&e.itemList.length>0&&e.itemList.map(function(e){e.roleInfo&&e.roleInfo.length>0&&(e.roleName=e.roleInfo.map(function(e){return e.roleName}).join("，"))})):e.itemList=[]})},getMerchantList:function(e,t){var a=this,l={marketCode:e};this.$http({method:"get",url:o.a.merchantList,params:l,showLoading:!1}).then(function(e){e&&0==e.code&&(a.merchantList=e.data,"员工信息-添加"===a.dialog_title&&(a.add_data.merchantCode=""),t&&(a.reqData.merchantCode=""))})},getOtherData:function(){var e=this;this.$http.get(o.a.marketList).then(function(t){t&&0==t.code&&(e.marketList=t.data)});var t=o.a.roleNameList+"/0";this.$http.get(t).then(function(t){t&&0==t.code&&t.data?e.allRole=t.data:e.allRole=[]})},getRoleList:function(e){var t=this,a=o.a.roleNameList+"/"+e;this.$http.get(a).then(function(e){e&&0==e.code&&e.data?t.roleList=e.data:t.roleList=[]})},search:function(){this.reqData.currentPage=1,this.getListData()},handlePage:function(e){this.reqData.currentPage=e,this.getListData()},indexMethod:function(e){return e+20*(this.reqData.currentPage-1)+1},add_person:function(){this.dialog_title="员工信息-添加",this.add_dialog=!0,delete this.add_data.empId,this.getRoleList(2)},clean_data:function(){s()(this.add_data,this.$options.data().add_data)},edit_person:function(e,t){this.dialog_title="员工信息-修改",this.editId=t.empId,this.getMerchantList(t.marketCode),0===t.employeeType.code?this.getRoleList(0):this.getRoleList(2),this.add_dialog=!0,this.add_data={empId:t.empId,available:t.available.code,employeeName:t.employeeName,employeeType:t.employeeType.code,marketCode:t.marketCode,marketName:t.marketName,merchantCode:t.merchantCode,merchantName:t.merchantName,mobile:t.mobile,roleIds:t.roleIds}},save_data:function(){var e=this;this.$refs.add_form.validate(function(t){if(t)if(e.marketList.map(function(t){t.marketCode==e.add_data.marketCode&&(e.add_data.marketName=t.marketName)}),e.merchantList.map(function(t){t.merchantCode==e.add_data.merchantCode&&(e.add_data.merchantName=t.merchantName)}),"员工信息-添加"==e.dialog_title)e.$http.post(o.a.employees,e.add_data).then(function(t){t&&0==t.code&&(e.$message({message:"保存成功",type:"success"}),e.add_dialog=!1,e.getListData())});else{var a=o.a.employees+"/"+e.editId;e.$http.put(a,e.add_data).then(function(t){t&&0==t.code&&(e.$message({message:"保存成功",type:"success"}),e.add_dialog=!1,e.getListData())})}})},reset_pwd:function(){var e=this;this.$confirm("请确定是否需要重置密码?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var t=o.a.change_pwd+"/"+e.add_data.empId+"/pwd/actions/reset";e.$http.patch(t).then(function(t){t&&0==t.code&&e.$message({message:"保存成功",type:"success"})})})},cancel:function(){this.add_dialog=!1},check_accessInfo:function(e,t){var a=this;this.accessInfo_dialog=!0;var l=o.a.employees+"/"+t.empId;this.$http.get(l).then(function(e){e&&0==e.code&&e.data&&(a.person_info=e.data,a.person_info.type=a.person_info.employeeType.desc,a.person_info.state=a.person_info.available.desc,a.person_info.roleName=a.person_info.roleInfo.map(function(e){return e.roleName}).join("，"),a.app_merchant=a.person_info.menuMap.app_merchant,a.app_operate=a.person_info.menuMap.app_operate,a.operate=a.person_info.menuMap.operate)}),this.person_info=t},leading_success:function(e,t){0==e.code?this.$message({message:"导入成功",type:"success"}):this.$message.error(e.msg+",请重新导入")},leading_error:function(){this.$message.error("导入失败，请重新导入")},marketData:function(e){this.reqData.marketCode=e}},created:function(){this.gTicket=this.$store.state.gTicket,this.getOtherData(),this.getListData()}}),i={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"contract-receipts"},[a("el-form",{ref:"reqData",staticClass:"c-search-form",attrs:{model:e.reqData,"label-width":"102px",inline:!0,"label-position":"right"}},[a("el-row",[a("el-col",{attrs:{span:8,xs:24}},[a("el-form-item",{attrs:{label:"员工姓名",prop:"employeeName"}},[a("el-input",{attrs:{clearable:""},model:{value:e.reqData.employeeName,callback:function(t){e.$set(e.reqData,"employeeName","string"==typeof t?t.trim():t)},expression:"reqData.employeeName"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:8,xs:24}},[a("el-form-item",{attrs:{label:"员工状态",prop:"available"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:e.reqData.available,callback:function(t){e.$set(e.reqData,"available",t)},expression:"reqData.available"}},[a("el-option",{attrs:{label:"正常",value:"1"}}),e._v(" "),a("el-option",{attrs:{label:"离职",value:"0"}})],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:8,xs:24}},[a("el-form-item",{attrs:{label:"手机号",prop:"mobile"}},[a("el-input",{attrs:{clearable:""},model:{value:e.reqData.mobile,callback:function(t){e.$set(e.reqData,"mobile","string"==typeof t?t.trim():t)},expression:"reqData.mobile"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"角色名称",prop:"roleId"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:e.reqData.roleId,callback:function(t){e.$set(e.reqData,"roleId",t)},expression:"reqData.roleId"}},e._l(e.allRole,function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.roleId}})}))],1)],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"商场名称",prop:"marketCode"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择"},on:{change:function(t){e.getMerchantList(e.reqData.marketCode,!0)}},model:{value:e.reqData.marketCode,callback:function(t){e.$set(e.reqData,"marketCode",t)},expression:"reqData.marketCode"}},e._l(e.marketList,function(e,t){return a("el-option",{key:t,attrs:{label:e.marketName,value:e.marketCode}})}))],1)],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"员工类型",prop:"employeeType"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:e.reqData.employeeType,callback:function(t){e.$set(e.reqData,"employeeType",t)},expression:"reqData.employeeType"}},[a("el-option",{attrs:{label:"正式员工",value:0}}),e._v(" "),a("el-option",{attrs:{label:"第三方公司员工",value:2}}),e._v(" "),a("el-option",{attrs:{label:"商户员工",value:1}})],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{span:8}},[a("el-col",{attrs:{span:8,offset:16}},[a("div",{staticClass:"c-footer-btn"},[a("el-button",{staticClass:"btn-search",attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.search}},[e._v("查询")])],1)])],1)],1),e._v(" "),a("div",{staticClass:"role_func"},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.$store.getters.getPermission("personnelMain_2"),expression:"$store.getters.getPermission('personnelMain_2')"}],staticClass:"btn-search btn-add",attrs:{type:"primary"},on:{click:e.add_person}},[e._v("添加")]),e._v(" "),a("el-upload",{staticClass:"upload-demo",attrs:{"show-file-list":!1,"on-success":e.leading_success,"on-error":e.leading_error,headers:{gTicket:e.gTicket,sys_authentication:e.$http.defaults.headers.sys_authentication,sys_id:e.$http.defaults.headers.sys_id},action:e.upload_url}},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.$store.getters.getPermission("personnelMain_5"),expression:"$store.getters.getPermission('personnelMain_5')"}],staticClass:"btn-search btn-add",attrs:{type:"primary"}},[e._v("导入员工信息")])],1)],1),e._v(" "),a("div",{staticClass:"c-table-wrap"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.itemList,align:"center",stripe:"",height:"500"}},[a("el-table-column",{attrs:{align:"center",type:"index",label:"序号",width:"50",index:e.indexMethod}}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"employeeNum",label:"员工ID"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"employeeName",label:"员工姓名"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"mobile",label:"手机号","min-width":"120"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"employeeType",label:"员工类型"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.employeeType.desc))])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"from",label:"员工所属部门","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.from?a("span",[e._v(e._s(t.row.from.desc))]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"marketName",label:"商场名称"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"roleName",label:"角色名称","min-width":"120"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"available",label:"员工状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.available.desc))])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"updateTime",label:"修改时间","min-width":"165"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"latestUpdateUser",label:"修改人"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"操作","min-width":"200",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticClass:"btn-handle",attrs:{type:"primary",disabled:!e.$store.getters.getPermission("personnelMain_3")},on:{click:function(a){e.edit_person(t.$index,t.row)}}},[e._v("\n            修改\n          ")]),e._v(" "),a("el-button",{staticClass:"btn-handle",attrs:{type:"primary",disabled:!e.$store.getters.getPermission("personnelMain_4")},on:{click:function(a){e.check_accessInfo(t.$index,t.row)}}},[e._v("\n            查看\n          ")])]}}])})],1)],1),e._v(" "),a("div",{staticClass:"pagination-box"},[a("pagenation",{attrs:{pageparams:e.pageparams,itemList:e.itemList},on:{handlePage:e.handlePage}})],1),e._v(" "),a("el-dialog",{staticClass:"l-dialog add_dialog",attrs:{title:e.dialog_title,visible:e.add_dialog},on:{"update:visible":function(t){e.add_dialog=t},close:e.clean_data}},[a("el-form",{ref:"add_form",attrs:{model:e.add_data,rules:e.add_rules,"label-width":"120px",inline:!0,"label-position":"right"}},[a("el-row",{attrs:{gutter:32}},[a("el-col",{attrs:{span:12,xs:24}},["员工信息-修改"==e.dialog_title?a("el-form-item",{attrs:{label:"员工ID",prop:"empId"}},[a("el-input",{attrs:{clearable:"",disabled:""},model:{value:e.add_data.empId,callback:function(t){e.$set(e.add_data,"empId","string"==typeof t?t.trim():t)},expression:"add_data.empId"}})],1):a("el-form-item",{attrs:{label:"所属商场",prop:"marketCode"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择"},on:{change:function(t){e.getMerchantList(e.add_data.marketCode)}},model:{value:e.add_data.marketCode,callback:function(t){e.$set(e.add_data,"marketCode",t)},expression:"add_data.marketCode"}},e._l(e.marketList,function(e,t){return a("el-option",{key:t,attrs:{label:e.marketName,value:e.marketCode}})}))],1)],1),e._v(" "),a("el-col",{attrs:{span:12,xs:24}},[a("el-form-item",{attrs:{label:"员工姓名",prop:"employeeName"}},[a("el-input",{attrs:{clearable:"",disabled:"员工信息-修改"==e.dialog_title},model:{value:e.add_data.employeeName,callback:function(t){e.$set(e.add_data,"employeeName","string"==typeof t?t.trim():t)},expression:"add_data.employeeName"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:32}},[0==!e.add_data.employeeType?a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"手机号",prop:"mobile"}},[a("el-input",{attrs:{clearable:""},model:{value:e.add_data.mobile,callback:function(t){e.$set(e.add_data,"mobile","string"==typeof t?t.trim():t)},expression:"add_data.mobile"}})],1)],1):e._e(),e._v(" "),a("el-col",{attrs:{span:12,xs:24}},[a("el-form-item",{attrs:{label:"员工类型",prop:"employeeType"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择",disabled:"员工信息-修改"==e.dialog_title},model:{value:e.add_data.employeeType,callback:function(t){e.$set(e.add_data,"employeeType",t)},expression:"add_data.employeeType"}},[a("el-option",{attrs:{label:"第三方公司员工",value:2}}),e._v(" "),a("el-option",{attrs:{label:"商户员工",value:1}}),e._v(" "),"员工信息-修改"==e.dialog_title?a("el-option",{attrs:{label:"正式员工",value:0}}):e._e()],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:32}},[0==!e.add_data.employeeType?a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"所属商户",prop:"merchantCode"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:e.add_data.merchantCode,callback:function(t){e.$set(e.add_data,"merchantCode",t)},expression:"add_data.merchantCode"}},e._l(e.merchantList,function(e,t){return a("el-option",{key:t,attrs:{label:e.merchantName,value:e.merchantCode}})}))],1)],1):e._e()],1),e._v(" "),a("el-row",{attrs:{gutter:32}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{staticClass:"u-role-ckeckBox",attrs:{label:"角色",prop:"roleIds"}},[a("el-checkbox-group",{model:{value:e.add_data.roleIds,callback:function(t){e.$set(e.add_data,"roleIds",t)},expression:"add_data.roleIds"}},e._l(e.roleList,function(t){return a("el-checkbox",{key:t.roleId,attrs:{label:t.roleId}},[e._v(e._s(t.name))])}))],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:32}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"状态",prop:"itemCode"}},[a("el-radio-group",{model:{value:e.add_data.available,callback:function(t){e.$set(e.add_data,"available",t)},expression:"add_data.available"}},[a("el-radio",{attrs:{label:1,value:1}},[e._v("正常")]),e._v(" "),a("el-radio",{attrs:{label:0,value:0}},[e._v("离职")])],1)],1)],1)],1),e._v(" "),"员工信息-修改"==e.dialog_title?a("el-row",{attrs:{gutter:32}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"密码修正",prop:"itemCode"}},[a("a",{staticClass:"reset_pwd",on:{click:e.reset_pwd}},[e._v("重置密码")])])],1)],1):e._e()],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"btn-save",attrs:{type:"primary"},on:{click:e.save_data}},[e._v("保存")]),e._v(" "),a("el-button",{staticClass:"btn-reset",attrs:{type:"primary"},on:{click:e.cancel}},[e._v("取消")])],1)],1),e._v(" "),a("el-dialog",{staticClass:"m-dialog access-dialog",attrs:{title:"权限-详情",visible:e.accessInfo_dialog},on:{"update:visible":function(t){e.accessInfo_dialog=t}}},[a("el-row",{attrs:{gutter:32}},[a("el-col",{attrs:{span:12}},[a("div",{staticClass:"u-roleInfo-item"},[a("label",[e._v("员工姓名")]),e._v(" "),a("span",[e._v(e._s(e.person_info.employeeName))])])]),e._v(" "),a("el-col",{attrs:{span:12}},[a("div",{staticClass:"u-roleInfo-item"},[a("label",[e._v("手机号")]),e._v(" "),a("span",[e._v(e._s(e.person_info.mobile))])])])],1),e._v(" "),a("el-row",{attrs:{gutter:32}},[a("el-col",{attrs:{span:12}},[a("div",{staticClass:"u-roleInfo-item"},[a("label",[e._v("员工状态")]),e._v(" "),a("span",[e._v(e._s(e.person_info.state))])])]),e._v(" "),a("el-col",{attrs:{span:12}},[a("div",{staticClass:"u-roleInfo-item"},[a("label",[e._v("商场名称")]),e._v(" "),a("span",[e._v(e._s(e.person_info.marketName))])])])],1),e._v(" "),a("el-row",{attrs:{gutter:32}},[a("el-col",{attrs:{span:12}},[a("div",{staticClass:"u-roleInfo-item"},[a("label",[e._v("员工类型")]),e._v(" "),a("span",[e._v(e._s(e.person_info.type))])])]),e._v(" "),a("el-col",{attrs:{span:12}},[a("div",{staticClass:"u-roleInfo-item"},[a("label",[e._v("商户名称")]),e._v(" "),a("span",[e._v(e._s(e.person_info.merchantName))])])])],1),e._v(" "),a("el-row",{attrs:{gutter:32}},[a("el-col",{attrs:{span:12}},[a("div",{staticClass:"u-roleInfo-item"},[a("label",[e._v("角色")]),e._v(" "),a("span",[e._v(e._s(e.person_info.roleName))])])])],1),e._v(" "),a("el-row",{attrs:{gutter:32}},[a("el-col",{attrs:{span:24}},[a("div",{staticClass:"u-menu-title"},[e._v("运营后台功能菜单")]),e._v(" "),a("el-scrollbar",{staticStyle:{height:"400px"}},[a("el-tree",{attrs:{data:e.operate,"node-key":"menuId",props:e.defaultProps}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:32}},[a("el-col",{attrs:{span:24}},[a("div",{staticClass:"u-menu-title"},[e._v("APP运营功能菜单")]),e._v(" "),a("el-tree",{attrs:{data:e.app_operate,"node-key":"menuId",props:e.defaultProps}})],1)],1),e._v(" "),a("el-row",{attrs:{gutter:32}},[a("el-col",{attrs:{span:24}},[a("div",{staticClass:"u-menu-title"},[e._v("APP商户功能菜单")]),e._v(" "),a("el-tree",{attrs:{data:e.app_merchant,"node-key":"menuId",props:e.defaultProps}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"btn-save",attrs:{type:"primary"},on:{click:function(t){e.accessInfo_dialog=!1}}},[e._v("关闭")])],1)],1)],1)},staticRenderFns:[]};var n=a("VU/8")(r,i,!1,function(e){a("hDUq"),a("1miJ")},"data-v-c129bcd6",null);t.default=n.exports},hDUq:function(e,t){}});
//# sourceMappingURL=23.e38f6d7f5a1829c1e55c.js.map